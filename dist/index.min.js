var e=Object.freeze({__proto__:null,get Pool(){return Vt},get attachRpc(){return Dt},get rpcFromWebWorker(){return a},get rpcFromWebWorkerWithTransfer(){return Dt}});function t(e,r=1){return e&&r?t(Object.getPrototypeOf(e),--r).concat(Object.getOwnPropertyNames(e).map((t=>"function"==typeof e[t]?t:null)).filter((e=>e))):[]}class r extends Error{constructor({name:e,message:t}){super(`${e}: ${t} (remote stack)`)}}function n(e){const r={};function n(e,t){r[e]=async(r,n)=>{if("function"==typeof n)try{n(void 0,await t(...r))}catch(e){n(e)}else try{t(...r)}catch(t){console.error(`[rpc-async] method "${e}" caused:`,t)}}}return{on:n,expose:function(r,i){let o=1;i&&r instanceof i&&(o=2);const s=t(r,o);e("expose target:",r);for(const t of s)"function"==typeof r[t]&&(e("expose",r?.constructor?.name,t),n(t,r[t].bind(r)))},handle:function(e,t,n){const i=r[e];"function"!=typeof i&&n(new Error(`No RPC handler for method "${e}"!`)),i(t,n)}}}function i(){const{name:e,debug:t}="undefined"!=typeof process&&process?.pid&&process?.env?{name:`PID:${process.pid}`,debug:!!process.env.DEBUG_RPC}:"undefined"!=typeof window?{name:"MAIN",debug:!!window.DEBUG_RPC}:"undefined"!=typeof self?{name:"WORKER",debug:!!self.DEBUG_RPC}:{name:"UNDEFINED",debug:!1};return t?(...t)=>console.log("[RPC",(new Date).toJSON(),`${e}]`,...t):()=>{}}var o=()=>Math.random().toString(36).slice(2);function s(e){const t="function"==typeof e.log?e.log:i(),{send:s,detach:a}=function(e,t){const r="function"==typeof t.encode?t.encode:e=>e,n="function"==typeof t.decode?t.decode:e=>e;return{send:e=>t.send(r(e)),detach:t.attach((t=>e(n(t))))||(()=>{})}}((function(n){t("route",n);const{id:i,method:o,params:a,result:d,error:f}=n;if(void 0!==o)c(o,a,((e,r)=>{t("route.handle:",o,{id:i,error:e,result:r});try{if(void 0!==i)s({id:i,error:e,result:r});else if(void 0!==e)throw e}catch(e){throw e}}));else{if(void 0===d&&void 0===f){if(t("INVALID Message:",n),e.ignoreInvalidMessages)return;const r=new Error("Invalid RPC message!");throw r.message=n,r}{const e=f?new r(f):void 0;u.dequeue(i,e,d)}}}),e),u=function(e={}){const t=e.defaultTimeout??3e4,r=e.createId??o,n={};return{enqueue:function(e,i=t){return new Promise(((t,o)=>{const s=r(),a=(e,r)=>e?o(e):t(r);n[s]={callback:a,timeout:setTimeout((()=>{a(new Error(`RpcAsync job "${s}" timed out!`)),delete n[s]}),i)},e(s)}))},dequeue:function(e,t,r){const i=n[e];i&&(clearTimeout(i.timeout),i.callback(t,r),delete n[e])},cancel:function(){for(const{callback:e}of Object.values(n))e(new Error("RpcClosing"))}}}(e),{on:d,expose:f,handle:c}=n(t);function l(e,t){s({method:e,params:t})}function h(t,r,n=e.timeout){return u.enqueue((e=>s({id:e,method:t,params:r})),n)}const p=new Proxy({},{get:(e,t,r)=>(...e)=>h(t,e)});return{on:d,expose:f,notify:new Proxy({},{get:(e,t,r)=>(...e)=>l(t,e)}),sendNotification:l,request:p,sendRequest:h,close:function(){a(),u.cancel()}}}function a(e){return s({send:t=>e.postMessage(t),attach:t=>{const r=e=>t(e.data);return e.addEventListener("message",r),()=>e.removeEventListener("message",r)}})}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var f={},c={exports:{}};function l(e){return e.length}var h={byteLength:l,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r},write:function(e,t,r=0,n=l(t)){const i=Math.min(n,e.byteLength-r);for(let n=0;n<i;n++)e[r+n]=t.charCodeAt(n);return i}};const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=new Uint8Array(256);for(let e=0;e<64;e++)b[p.charCodeAt(e)]=e;function y(e){let t=e.length;return 61===e.charCodeAt(t-1)&&t--,t>1&&61===e.charCodeAt(t-1)&&t--,3*t>>>2}b[45]=62,b[95]=63;var w={byteLength:y,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t;n+=3)r+=p[e[n]>>2]+p[(3&e[n])<<4|e[n+1]>>4]+p[(15&e[n+1])<<2|e[n+2]>>6]+p[63&e[n+2]];return t%3==2?r=r.substring(0,r.length-1)+"=":t%3==1&&(r=r.substring(0,r.length-2)+"=="),r},write:function(e,t,r=0,n=y(t)){const i=Math.min(n,e.byteLength-r);for(let r=0,n=0;n<i;r+=4){const i=b[t.charCodeAt(r)],o=b[t.charCodeAt(r+1)],s=b[t.charCodeAt(r+2)],a=b[t.charCodeAt(r+3)];e[n++]=i<<2|o>>4,e[n++]=(15&o)<<4|s>>2,e[n++]=(3&s)<<6|63&a}return i}};function g(e){return e.length>>>1}var _={byteLength:g,toString:function(e){const t=e.byteLength;e=new DataView(e.buffer,e.byteOffset,t);let r="",n=0;for(let i=t-t%4;n<i;n+=4)r+=e.getUint32(n).toString(16).padStart(8,"0");for(;n<t;n++)r+=e.getUint8(n).toString(16).padStart(2,"0");return r},write:function(e,t,r=0,n=g(t)){const i=Math.min(n,e.byteLength-r);for(let n=0;n<i;n++){const i=m(t.charCodeAt(2*n)),o=m(t.charCodeAt(2*n+1));if(void 0===i||void 0===o)return e.subarray(0,n);e[r+n]=i<<4|o}return i}};function m(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:void 0}function S(e){let t=0;for(let r=0,n=e.length;r<n;r++){const i=e.charCodeAt(r);if(i>=55296&&i<=56319&&r+1<n){const n=e.charCodeAt(r+1);if(n>=56320&&n<=57343){t+=4,r++;continue}}t+=i<=127?1:i<=2047?2:3}return t}let x,v;if("undefined"!=typeof TextDecoder){const e=new TextDecoder;x=function(t){return e.decode(t)}}else x=function(e){const t=e.byteLength;let r="",n=0;for(;n<t;){let i=e[n];if(i<=127){r+=String.fromCharCode(i),n++;continue}let o=0,s=0;if(i<=223?(o=1,s=31&i):i<=239?(o=2,s=15&i):i<=244&&(o=3,s=7&i),t-n-o>0){let t=0;for(;t<o;)i=e[n+t+1],s=s<<6|63&i,t+=1}else s=65533,o=t-n;r+=String.fromCodePoint(s),n+=o+1}return r};if("undefined"!=typeof TextEncoder){const e=new TextEncoder;v=function(t,r,n=0,i=S(r)){const o=Math.min(i,t.byteLength-n);return e.encodeInto(r,t.subarray(n,n+o)),o}}else v=function(e,t,r=0,n=S(t)){const i=Math.min(n,e.byteLength-r);e=e.subarray(r,r+i);let o=0,s=0;for(;o<t.length;){const r=t.codePointAt(o);if(r<=127){e[s++]=r,o++;continue}let n=0,i=0;for(r<=2047?(n=6,i=192):r<=65535?(n=12,i=224):r<=2097151&&(n=18,i=240),e[s++]=i|r>>n,n-=6;n>=0;)e[s++]=128|r>>n&63,n-=6;o+=r>=65536?2:1}return i};var L={byteLength:S,toString:x,write:v};function k(e){return 2*e.length}var E={byteLength:k,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t-1;n+=2)r+=String.fromCharCode(e[n]+256*e[n+1]);return r},write:function(e,t,r=0,n=k(t)){const i=Math.min(n,e.byteLength-r);let o=i;for(let n=0;n<t.length&&!((o-=2)<0);++n){const i=t.charCodeAt(n),o=i>>8,s=i%256;e[r+2*n]=s,e[r+2*n+1]=o}return i}};!function(e,t){const r=h,n=w,i=_,o=L,s=E,a=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function u(e){switch(e){case"ascii":return r;case"base64":return n;case"hex":return i;case"utf8":case"utf-8":case void 0:return o;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s;default:throw new Error(`Unknown encoding: ${e}`)}}function d(e){return e instanceof Uint8Array}function f(e,t,r){return"string"==typeof e?function(e,t){const r=u(t),n=new Uint8Array(r.byteLength(e));return r.write(n,e,0,n.byteLength),n}(e,t):Array.isArray(e)?function(e){const t=new Uint8Array(e.length);return t.set(e),t}(e):ArrayBuffer.isView(e)?function(e){const t=new Uint8Array(e.byteLength);return t.set(e),t}(e):function(e,t,r){return new Uint8Array(e,t,r)}(e,t,r)}function c(e,t,r,n,i){if(0===e.byteLength)return-1;if("string"==typeof r?(n=r,r=0):void 0===r?r=i?0:e.length-1:r<0&&(r+=e.byteLength),r>=e.byteLength){if(i)return-1;r=e.byteLength-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t)t=f(t,n);else if("number"==typeof t)return t&=255,i?e.indexOf(t,r):e.lastIndexOf(t,r);if(0===t.byteLength)return-1;if(i){let n=-1;for(let i=r;i<e.byteLength;i++)if(e[i]===t[-1===n?0:i-n]){if(-1===n&&(n=i),i-n+1===t.byteLength)return n}else-1!==n&&(i-=i-n),n=-1}else{r+t.byteLength>e.byteLength&&(r=e.byteLength-t.byteLength);for(let n=r;n>=0;n--){let r=!0;for(let i=0;i<t.byteLength;i++)if(e[n+i]!==t[i]){r=!1;break}if(r)return n}}return-1}function l(e,t,r,n){return c(e,t,r,n,!0)}function p(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}e.exports=t={isBuffer:d,isEncoding:function(e){try{return u(e),!0}catch{return!1}},alloc:function(e,r,n){const i=new Uint8Array(e);return void 0!==r&&t.fill(i,r,0,i.byteLength,n),i},allocUnsafe:function(e){return new Uint8Array(e)},allocUnsafeSlow:function(e){return new Uint8Array(e)},byteLength:function(e,t){return u(t).byteLength(e)},compare:function(e,t){if(e===t)return 0;const r=Math.min(e.byteLength,t.byteLength);e=new DataView(e.buffer,e.byteOffset,e.byteLength),t=new DataView(t.buffer,t.byteOffset,t.byteLength);let n=0;for(let i=r-r%4;n<i;n+=4){if(e.getUint32(n,a)!==t.getUint32(n,a))break}for(;n<r;n++){const r=e.getUint8(n),i=t.getUint8(n);if(r<i)return-1;if(r>i)return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0},concat:function(e,t){void 0===t&&(t=e.reduce(((e,t)=>e+t.byteLength),0));const r=new Uint8Array(t);let n=0;for(const t of e){if(n+t.byteLength>r.byteLength){const e=t.subarray(0,r.byteLength-n);return r.set(e,n),r}r.set(t,n),n+=t.byteLength}return r},copy:function(e,t,r=0,n=0,i=e.byteLength){if(i>0&&i<n)return 0;if(i===n)return 0;if(0===e.byteLength||0===t.byteLength)return 0;if(r<0)throw new RangeError("targetStart is out of range");if(n<0||n>=e.byteLength)throw new RangeError("sourceStart is out of range");if(i<0)throw new RangeError("sourceEnd is out of range");r>=t.byteLength&&(r=t.byteLength),i>e.byteLength&&(i=e.byteLength),t.byteLength-r<i-n&&(i=t.length-r+n);const o=i-n;return e===t?t.copyWithin(r,n,i):t.set(e.subarray(n,i),r),o},equals:function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;const r=e.byteLength;e=new DataView(e.buffer,e.byteOffset,e.byteLength),t=new DataView(t.buffer,t.byteOffset,t.byteLength);let n=0;for(let i=r-r%4;n<i;n+=4)if(e.getUint32(n,a)!==t.getUint32(n,a))return!1;for(;n<r;n++)if(e.getUint8(n)!==t.getUint8(n))return!1;return!0},fill:function(e,t,r,n,i){if("string"==typeof t?"string"==typeof r?(i=r,r=0,n=e.byteLength):"string"==typeof n&&(i=n,n=e.byteLength):"number"==typeof t?t&=255:"boolean"==typeof t&&(t=+t),r<0||e.byteLength<r||e.byteLength<n)throw new RangeError("Out of range index");if(void 0===r&&(r=0),void 0===n&&(n=e.byteLength),n<=r)return e;if(t||(t=0),"number"==typeof t)for(let i=r;i<n;++i)e[i]=t;else{const o=(t=d(t)?t:f(t,i)).byteLength;for(let i=0;i<n-r;++i)e[i+r]=t[i%o]}return e},from:f,includes:function(e,t,r,n){return-1!==l(e,t,r,n)},indexOf:l,lastIndexOf:function(e,t,r,n){return c(e,t,r,n,!1)},swap16:function(e){const t=e.byteLength;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<t;r+=2)p(e,r,r+1);return e},swap32:function(e){const t=e.byteLength;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<t;r+=4)p(e,r,r+3),p(e,r+1,r+2);return e},swap64:function(e){const t=e.byteLength;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<t;r+=8)p(e,r,r+7),p(e,r+1,r+6),p(e,r+2,r+5),p(e,r+3,r+4);return e},toBuffer:function(e){return e},toString:function(e,t,r=0,n=e.byteLength){const i=e.byteLength;return r>=i||n<=r?"":(r<0&&(r=0),n>i&&(n=i),(0!==r||n<i)&&(e=e.subarray(r,n)),u(t).toString(e))},write:function(e,t,r,n,i){return void 0===r?i="utf8":void 0===n&&"string"==typeof r?(i=r,r=void 0):void 0===i&&"string"==typeof n&&(i=n,n=void 0),u(i).write(e,t,r,n)},writeDoubleLE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setFloat64(r,t,!0),r+8},writeFloatLE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setFloat32(r,t,!0),r+4},writeUInt32LE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setUint32(r,t,!0),r+4},writeInt32LE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setInt32(r,t,!0),r+4},readDoubleLE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},readFloatLE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},readUInt32LE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(t,!0)},readInt32LE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getInt32(t,!0)}}}(c,c.exports);var O=c.exports,A=u(O),T={};const U=T.LE=255===new Uint8Array(new Uint16Array([255]).buffer)[0];T.BE=!U;var N={exports:{}};!function(e,t){const r=O,{BE:n}=T,i=(t=e.exports={preencode(e,t){e.end+=t.byteLength},encode(e,t){e.buffer.set(t,e.start),e.start+=t.byteLength},decode(e){const t=e.buffer.subarray(e.start,e.end);return e.start=e.end,t}}).buffer={preencode(e,t){t?s.preencode(e,t):e.end++},encode(e,t){t?s.encode(e,t):e.buffer[e.start++]=0},decode(e){const t=e.buffer.subarray(e.start);return 0===t.byteLength?null:(e.start=e.end,t)}};function o(e,t){const r=e.BYTES_PER_ELEMENT;return{preencode(e,t){e.end+=t.byteLength},encode(e,r){const i=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);n&&t&&t(i),e.buffer.set(i,e.start),e.start+=r.byteLength},decode(i){let o=i.buffer.subarray(i.start);return o.byteOffset%r!=0&&(o=new Uint8Array(o)),n&&t&&t(o),i.start=i.end,new e(o.buffer,o.byteOffset,o.byteLength/r)}}}t.binary={...i,preencode(e,t){"string"==typeof t?u.preencode(e,t):i.preencode(e,t)},encode(e,t){"string"==typeof t?u.encode(e,t):i.encode(e,t)}},t.arraybuffer={preencode(e,t){e.end+=t.byteLength},encode(e,t){const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength},decode(e){const t=new ArrayBuffer(e.end-e.start);return new Uint8Array(t).set(e.buffer.subarray(e.start)),e.start=e.end,t}};const s=t.uint8array=o(Uint8Array);function a(e){return{preencode(t,n){t.end+=r.byteLength(n,e)},encode(t,n){t.start+=r.write(t.buffer,n,t.start,e)},decode(t){const n=r.toString(t.buffer,e,t.start);return t.start=t.end,n}}}t.uint16array=o(Uint16Array,r.swap16),t.uint32array=o(Uint32Array,r.swap32),t.int8array=o(Int8Array),t.int16array=o(Int16Array,r.swap16),t.int32array=o(Int32Array,r.swap32),t.biguint64array=o(BigUint64Array,r.swap64),t.bigint64array=o(BigInt64Array,r.swap64),t.float32array=o(Float32Array,r.swap32),t.float64array=o(Float64Array,r.swap64);const u=t.string=t.utf8=a("utf-8");t.ascii=a("ascii"),t.hex=a("hex"),t.base64=a("base64"),t.ucs2=t.utf16le=a("utf16le"),t.array=function(e){return{preencode(t,r){for(const n of r)e.preencode(t,n)},encode(t,r){for(const n of r)e.encode(t,n)},decode(t){const r=[];for(;t.start<t.end;)r.push(e.decode(t));return r}}},t.json={preencode(e,t){u.preencode(e,JSON.stringify(t))},encode(e,t){u.encode(e,JSON.stringify(t))},decode:e=>JSON.parse(u.decode(e))},t.ndjson={preencode(e,t){u.preencode(e,JSON.stringify(t)+"\n")},encode(e,t){u.encode(e,JSON.stringify(t)+"\n")},decode:e=>JSON.parse(u.decode(e))}}(N,N.exports);var C=N.exports,M={preencode:function e(t,r){if(r<251)t.end++;else if(r<256)t.end+=2;else if(r<65536)t.end+=3;else if(r<16777216)t.end+=4;else if(r<4294967296)t.end+=5;else{t.end++;const n=Math.floor(Math.log(r)/Math.log(2))-32;e(t,n),t.end+=6}},encode:function e(t,r){const n=251,i=r-n;if(r<n)t.buffer[t.start++]=r;else if(r<256)t.buffer[t.start++]=n,t.buffer[t.start++]=i;else if(r<65536)t.buffer[t.start++]=252,t.buffer[t.start++]=i>>8&255,t.buffer[t.start++]=255&i;else if(r<16777216)t.buffer[t.start++]=253,t.buffer[t.start++]=i>>16,t.buffer[t.start++]=i>>8&255,t.buffer[t.start++]=255&i;else if(r<4294967296)t.buffer[t.start++]=254,t.buffer[t.start++]=i>>24,t.buffer[t.start++]=i>>16&255,t.buffer[t.start++]=i>>8&255,t.buffer[t.start++]=255&i;else{const r=Math.floor(Math.log(i)/Math.log(2))-32;t.buffer[t.start++]=255,e(t,r);const n=i/Math.pow(2,r-11);for(let e=5;e>=0;e--)t.buffer[t.start++]=n/Math.pow(2,8*e)&255}},decode:function e(t){const r=251;if(t.end-t.start<1)throw new Error("Out of bounds");const n=t.buffer[t.start++];if(n<r)return n;if(t.end-t.start<n-r+1)throw new Error("Out of bounds.");if(n<252)return t.buffer[t.start++]+r;if(n<253)return(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<254)return(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<255)return 16777216*t.buffer[t.start++]+(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;const i=e(t);if(t.end-t.start<6)throw new Error("Out of bounds");let o=0;for(let e=5;e>=0;e--)o+=t.buffer[t.start++]*Math.pow(2,8*e);return o*Math.pow(2,i-11)+r}};!function(e){const t=O,{BE:r}=T;e.state=function(e=0,t=0,r=null){return{start:e,end:t,buffer:r,cache:null}};const n=e.raw=C,i=e.uint={preencode(e,t){e.end+=t<=252?1:t<=65535?3:t<=4294967295?5:9},encode(e,t){t<=252?o.encode(e,t):t<=65535?(e.buffer[e.start++]=253,s.encode(e,t)):t<=4294967295?(e.buffer[e.start++]=254,u.encode(e,t)):(e.buffer[e.start++]=255,l.encode(e,t))},decode(e){const t=o.decode(e);return t<=252?t:253===t?s.decode(e):254===t?u.decode(e):l.decode(e)}},o=e.uint8={preencode(e,t){e.end+=1},encode(e,t){e.buffer[e.start++]=t},decode(e){if(e.start>=e.end)throw new Error("Out of bounds");return e.buffer[e.start++]}},s=e.uint16={preencode(e,t){e.end+=2},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8},decode(e){if(e.end-e.start<2)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]}},a=e.uint24={preencode(e,t){e.end+=3},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16},decode(e){if(e.end-e.start<3)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]}},u=e.uint32={preencode(e,t){e.end+=4},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16,e.buffer[e.start++]=t>>>24},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]+16777216*e.buffer[e.start++]}},d=e.uint40={preencode(e,t){e.end+=5},encode(e,t){const r=Math.floor(t/256);o.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<5)throw new Error("Out of bounds");return o.decode(e)+256*u.decode(e)}},f=e.uint48={preencode(e,t){e.end+=6},encode(e,t){const r=Math.floor(t/65536);s.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<6)throw new Error("Out of bounds");return s.decode(e)+65536*u.decode(e)}},c=e.uint56={preencode(e,t){e.end+=7},encode(e,t){const r=Math.floor(t/16777216);a.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<7)throw new Error("Out of bounds");return a.decode(e)+16777216*u.decode(e)}},l=e.uint64={preencode(e,t){e.end+=8},encode(e,t){const r=Math.floor(t/4294967296);u.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");return u.decode(e)+4294967296*u.decode(e)}};e.int=E(i),e.int8=E(o),e.int16=E(s),e.int24=E(a),e.int32=E(u),e.int40=E(d),e.int48=E(f),e.int56=E(c),e.int64=E(l);const h=e.biguint64={preencode(e,t){e.end+=8},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setBigUint64(0,t,!0),e.start+=8},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getBigUint64(0,!0);return e.start+=8,t}};e.bigint64=U(h);const p=e.biguint={preencode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;i.preencode(e,r),e.end+=8*r},encode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;i.encode(e,r);const n=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*r);for(let e=t,r=0;e;e>>=64n,r+=8)n.setBigUint64(r,BigInt.asUintN(64,e),!0);e.start+=8*r},decode(e){const t=i.decode(e);if(e.end-e.start<8*t)throw new Error("Out of bounds");const r=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*t);let n=0n;for(let e=t-1;e>=0;e--)n=(n<<64n)+r.getBigUint64(8*e,!0);return e.start+=8*t,n}};e.bigint=U(p),e.lexint=M,e.float32={preencode(e,t){e.end+=4},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).setFloat32(0,t,!0),e.start+=4},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).getFloat32(0,!0);return e.start+=4,t}},e.float64={preencode(e,t){e.end+=8},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setFloat64(0,t,!0),e.start+=8},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getFloat64(0,!0);return e.start+=8,t}};const b=e.buffer={preencode(e,t){t?w.preencode(e,t):e.end++},encode(e,t){t?w.encode(e,t):e.buffer[e.start++]=0},decode(e){const t=i.decode(e);if(0===t)return null;if(e.end-e.start<t)throw new Error("Out of bounds");return e.buffer.subarray(e.start,e.start+=t)}};function y(e,t){const n=e.BYTES_PER_ELEMENT;return{preencode(e,t){i.preencode(e,t.length),e.end+=t.byteLength},encode(e,n){i.encode(e,n.length);const o=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);r&&t&&t(o),e.buffer.set(o,e.start),e.start+=n.byteLength},decode(o){const s=i.decode(o);let a=o.buffer.subarray(o.start,o.start+=s*n);if(a.byteLength!==s*n)throw new Error("Out of bounds");return a.byteOffset%n!=0&&(a=new Uint8Array(a)),r&&t&&t(a),new e(a.buffer,a.byteOffset,a.byteLength/n)}}}e.binary={...b,preencode(e,t){"string"==typeof t?_.preencode(e,t):b.preencode(e,t)},encode(e,t){"string"==typeof t?_.encode(e,t):b.encode(e,t)}},e.arraybuffer={preencode(e,t){i.preencode(e,t.byteLength),e.end+=t.byteLength},encode(e,t){i.encode(e,t.byteLength);const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength},decode(e){const t=i.decode(e),r=new ArrayBuffer(t);return new Uint8Array(r).set(e.buffer.subarray(e.start,e.start+=t)),r}};const w=e.uint8array=y(Uint8Array);function g(e){return{preencode(r,n){const o=t.byteLength(n,e);i.preencode(r,o),r.end+=o},encode(r,n){const o=t.byteLength(n,e);i.encode(r,o),t.write(r.buffer,n,r.start,e),r.start+=o},decode(r){const n=i.decode(r);if(r.end-r.start<n)throw new Error("Out of bounds");return t.toString(r.buffer,e,r.start,r.start+=n)},fixed:r=>({preencode(e){e.end+=r},encode(n,i){t.write(n.buffer,i,n.start,r,e),n.start+=r},decode(n){if(n.end-n.start<r)throw new Error("Out of bounds");return t.toString(n.buffer,e,n.start,n.start+=r)}})}}e.uint16array=y(Uint16Array,t.swap16),e.uint32array=y(Uint32Array,t.swap32),e.int8array=y(Int8Array),e.int16array=y(Int16Array,t.swap16),e.int32array=y(Int32Array,t.swap32),e.biguint64array=y(BigUint64Array,t.swap64),e.bigint64array=y(BigInt64Array,t.swap64),e.float32array=y(Float32Array,t.swap32),e.float64array=y(Float64Array,t.swap64);const _=e.string=e.utf8=g("utf-8");e.ascii=g("ascii"),e.hex=g("hex"),e.base64=g("base64"),e.ucs2=e.utf16le=g("utf16le"),e.bool={preencode(e,t){e.end++},encode(e,t){e.buffer[e.start++]=t?1:0},decode(e){if(e.start>=e.end)throw Error("Out of bounds");return 1===e.buffer[e.start++]}};const m=e.fixed=function(e){return{preencode(t,r){t.end+=e},encode(t,r){t.buffer.set(r,t.start),t.start+=e},decode(t){if(t.end-t.start<e)throw new Error("Out of bounds");return t.buffer.subarray(t.start,t.start+=e)}}};e.fixed32=m(32),e.fixed64=m(64),e.array=function(e){return{preencode(t,r){i.preencode(t,r.length);for(let n=0;n<r.length;n++)e.preencode(t,r[n])},encode(t,r){i.encode(t,r.length);for(let n=0;n<r.length;n++)e.encode(t,r[n])},decode(t){const r=i.decode(t);if(r>1048576)throw new Error("Array is too big");const n=new Array(r);for(let i=0;i<r;i++)n[i]=e.decode(t);return n}}},e.frame=function(t){const r=e.state();return{preencode(e,r){const n=e.end;t.preencode(e,r),i.preencode(e,e.end-n)},encode(e,n){r.end=0,t.preencode(r,n),i.encode(e,r.end),t.encode(e,n)},decode(e){const r=e.end,n=i.decode(e);e.end=e.start+n;const o=t.decode(e);return e.start=e.end,e.end=r,o}}},e.json={preencode(e,t){_.preencode(e,JSON.stringify(t))},encode(e,t){_.encode(e,JSON.stringify(t))},decode:e=>JSON.parse(_.decode(e))},e.ndjson={preencode(e,t){_.preencode(e,JSON.stringify(t)+"\n")},encode(e,t){_.encode(e,JSON.stringify(t)+"\n")},decode:e=>JSON.parse(_.decode(e))},e.none={preencode(e,t){},encode(e,t){},decode:e=>null};const S={preencode(e,t){i.preencode(e,t.length);for(let r=0;r<t.length;r++)L.preencode(e,t[r])},encode(e,t){i.encode(e,t.length);for(let r=0;r<t.length;r++)L.encode(e,t[r])},decode(e){const t=[];let r=i.decode(e);for(;r-- >0;)t.push(L.decode(e));return t}},x={preencode(e,t){const r=Object.keys(t);i.preencode(e,r.length);for(const n of r)_.preencode(e,n),L.preencode(e,t[n])},encode(e,t){const r=Object.keys(t);i.encode(e,r.length);for(const n of r)_.encode(e,n),L.encode(e,t[n])},decode(e){let t=i.decode(e);const r={};for(;t-- >0;){r[_.decode(e)]=L.decode(e)}return r}},v=[e.none,e.bool,e.string,e.buffer,e.uint,e.int,e.float64,S,x],L=e.any={preencode(e,t){const r=k(t);i.preencode(e,r),v[r].preencode(e,t)},encode(e,t){const r=k(t);i.encode(e,r),v[r].encode(e,t)},decode(e){const t=i.decode(e);if(t>=v.length)throw new Error("Unknown type: "+t);return v[t].decode(e)}};function k(e){if(null==e)return 0;if("boolean"==typeof e)return 1;if("string"==typeof e)return 2;if(t.isBuffer(e))return 3;if("number"==typeof e)return Number.isInteger(e)?e>=0?4:5:6;if(Array.isArray(e))return 7;if("object"==typeof e)return 8;throw new Error("Unsupported type for "+e)}function E(e){return{preencode(t,r){e.preencode(t,A(r))},encode(t,r){e.encode(t,A(r))},decode:t=>function(e){return 0===e?e:1&e?-(e+1)/2:e/2}(e.decode(t))}}function A(e){return e<0?2*-e-1:0===e?0:2*e}function U(e){return{preencode(t,r){e.preencode(t,N(r))},encode(t,r){e.encode(t,N(r))},decode:t=>function(e){return 0n===e?e:0n===(1n&e)?e/2n:-(e+1n)/2n}(e.decode(t))}}function N(e){return e<0n?2n*-e-1n:0n===e?0n:2n*e}e.from=function(e){return"string"==typeof e?function(e){switch(e){case"ascii":return n.ascii;case"utf-8":case"utf8":return n.utf8;case"hex":return n.hex;case"base64":return n.base64;case"utf16-le":case"utf16le":case"ucs-2":case"ucs2":return n.ucs2;case"ndjson":return n.ndjson;case"json":return n.json;default:return n.binary}}(e):e.preencode?e:e.encodingLength?function(e){return{preencode(t,r){t.end+=e.encodingLength(r)},encode(t,r){e.encode(r,t.buffer,t.start),t.start+=e.encode.bytes},decode(t){const r=e.decode(t.buffer,t.start,t.end);return t.start+=e.decode.bytes,r}}}(e):function(e){let t=null,r=null;return{preencode(n,i){t=i,r=e.encode(i),n.end+=r.byteLength},encode(i,o){n.encode(i,o===t?r:e.encode(o)),t=r=null},decode:t=>e.decode(n.decode(t))}}(e)},e.encode=function(r,n){const i=e.state();return r.preencode(i,n),i.buffer=t.allocUnsafe(i.end),r.encode(i,n),i.buffer},e.decode=function(t,r){return t.decode(e.state(0,r.byteLength,r))}}(f);var P=u(f);function W(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}function R(e){return"undefined"!=typeof WritableStream&&e instanceof WritableStream}function j(e){return Array.isArray(e)?2===e.length&&W(e[0])&&R(e[1]):"object"==typeof e&&null!==e&&W(e.readable)&&R(e.writable)}var I,B={exports:{}},q="object"==typeof Reflect?Reflect:null,D=q&&"function"==typeof q.apply?q.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};I=q&&"function"==typeof q.ownKeys?q.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var F=Number.isNaN||function(e){return e!=e};function V(){V.init.call(this)}B.exports=V;var J=B.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}ee(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&ee(e,"error",t,{once:!0})}(e,i)}))};V.EventEmitter=V,V.prototype._events=void 0,V.prototype._eventsCount=0,V.prototype._maxListeners=void 0;var z=10;function Q(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function $(e){return void 0===e._maxListeners?V.defaultMaxListeners:e._maxListeners}function H(e,t,r,n){var i,o,s,a;if(Q(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=$(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=G.bind(n);return i.listener=r,n.wrapFn=i,i}function Y(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):Z(i,i.length)}function X(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function Z(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function ee(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(V,"defaultMaxListeners",{enumerable:!0,get:function(){return z},set:function(e){if("number"!=typeof e||e<0||F(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");z=e}}),V.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},V.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||F(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},V.prototype.getMaxListeners=function(){return $(this)},V.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)D(a,this,t);else{var u=a.length,d=Z(a,u);for(r=0;r<u;++r)D(d[r],this,t)}return!0},V.prototype.addListener=function(e,t){return H(this,e,t,!1)},V.prototype.on=V.prototype.addListener,V.prototype.prependListener=function(e,t){return H(this,e,t,!0)},V.prototype.once=function(e,t){return Q(t),this.on(e,K(this,e,t)),this},V.prototype.prependOnceListener=function(e,t){return Q(t),this.prependListener(e,K(this,e,t)),this},V.prototype.removeListener=function(e,t){var r,n,i,o,s;if(Q(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},V.prototype.off=V.prototype.removeListener,V.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},V.prototype.listeners=function(e){return Y(this,e,!0)},V.prototype.rawListeners=function(e){return Y(this,e,!1)},V.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):X.call(e,t)},V.prototype.listenerCount=X,V.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]};var te=B.exports,re=B.exports.EventEmitter,ne=B.exports.init,ie=B.exports.listenerCount,oe=d(Object.freeze({__proto__:null,EventEmitter:re,default:te,init:ne,listenerCount:ie,once:J})),se="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);const ae=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};var ue=d(e);const{EventEmitter:de}=oe,fe=new Error("Stream was destroyed"),ce=(new Error("Premature close"),se),le=class{constructor(e){this.hwm=e||16,this.head=new ae(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new ae(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){const e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}isEmpty(){return 0===this.length}},he=ue,pe=536870911,be=1^pe,ye=2^pe,we=64,ge=128,_e=256,me=1024,Se=2048,xe=4096,ve=8192,Le=16384,ke=32768,Ee=131072,Oe=131328,Ae=16^pe,Te=768^pe,Ue=536838143,Ne=32^pe,Ce=536739839,Me=2<<18,Pe=4<<18,We=8<<18,Re=16<<18,je=32<<18,Ie=64<<18,Be=128<<18,qe=256<<18,De=512<<18,Fe=1024<<18,Ve=469499903,Je=535822335,ze=503316479,Qe=268435455,$e=262160,He=536608751,Ge=8404992,Ke=14,Ye=15,Xe=8405006,Ze=33587200,et=33587215,tt=2359296,rt=270794767,nt=Symbol.asyncIterator||Symbol("asyncIterator");class it{constructor(e,{highWaterMark:t=16384,map:r=null,mapWritable:n,byteLength:i,byteLengthWritable:o}={}){this.stream=e,this.queue=new le,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||i||vt,this.map=n||r,this.afterWrite=ft.bind(this),this.afterUpdateNextTick=ht.bind(this)}get ended(){return!!(this.stream._duplexState&je)}push(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=We,!0):(this.stream._duplexState|=6291456,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}end(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=(this.stream._duplexState|De)&Je}autoBatch(e,t){const r=[],n=this.stream;for(r.push(e);(n._duplexState&rt)===tt;)r.push(n._writableState.shift());if(n._duplexState&Ye)return t(null);n._writev(r,t)}update(){const e=this.stream;e._duplexState|=Me;do{for(;(e._duplexState&rt)===We;){const t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}updateNonPrimary(){const e=this.stream;if((144965647&e._duplexState)===De)return e._duplexState=402653183&e._duplexState|262144,void e._final(ut.bind(this));4!=(e._duplexState&Ke)?1==(e._duplexState&et)&&(e._duplexState=(e._duplexState|$e)&be,e._open(pt.bind(this))):e._duplexState&Ze||(e._duplexState|=$e,e._destroy(dt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&Be)&&(this.stream._duplexState&=ze,!0)}updateCallback(){(35127311&this.stream._duplexState)===Pe?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Be||(this.stream._duplexState|=Be,this.stream._duplexState&Me||ce(this.afterUpdateNextTick))}}class ot{constructor(e,{highWaterMark:t=16384,map:r=null,mapReadable:n,byteLength:i,byteLengthReadable:o}={}){this.stream=e,this.queue=new le,this.highWaterMark=0===t?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=o||i||vt,this.map=n||r,this.pipeTo=null,this.afterRead=ct.bind(this),this.afterUpdateNextTick=lt.bind(this)}get ended(){return!!(this.stream._duplexState&Le)}pipe(e,t){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new st(this.stream,e,t),t&&this.stream.on("error",Lt),xt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Lt),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const t=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",at.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}unshift(e){const t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){const r=t[e];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((16527&e._duplexState)===ge){const t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Te),e._duplexState&Se&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=Ee,this.updateNextTick()),null}drain(){const e=this.stream;for(;(16527&e._duplexState)===ge&&768&e._duplexState;){const t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Te),e._duplexState&Se&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===Ee;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=ve,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=Ne}updateNonPrimary(){const e=this.stream;(1167&e._duplexState)===me&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&Xe)===Ge&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(e._duplexState&Ke)?1==(e._duplexState&et)&&(e._duplexState=(e._duplexState|$e)&be,e._open(pt.bind(this))):e._duplexState&Ze||(e._duplexState|=$e,e._destroy(dt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&ke)&&(this.stream._duplexState&=Ue,!0)}updateCallback(){(32879&this.stream._duplexState)===we?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&ke||(this.stream._duplexState|=ke,32&this.stream._duplexState||ce(this.afterUpdateNextTick))}}class st{constructor(e,t,r){this.from=e,this.to=t,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&Le||this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&Le&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function at(){this.stream._duplexState|=512,this.updateCallback()}function ut(e){const t=this.stream;e&&t.destroy(e),t._duplexState&Ke||(t._duplexState|=je,t.emit("finish")),(t._duplexState&Xe)===Ge&&(t._duplexState|=4),t._duplexState&=Ve,t._duplexState&Me?this.updateNextTick():this.update()}function dt(e){const t=this.stream;e||this.error===fe||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");const r=t._readableState,n=t._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(t,e),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(t,e)}}function ft(e){const t=this.stream;e&&t.destroy(e),t._duplexState&=Ve,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),(6553615&t._duplexState)===Re&&(t._duplexState&=532676607,(t._duplexState&Ie)===Ie&&t.emit("drain")),this.updateCallback()}function ct(e){e&&this.stream.destroy(e),this.stream._duplexState&=Ae,!1!==this.readAhead||this.stream._duplexState&_e||(this.stream._duplexState&=Ce),this.updateCallback()}function lt(){32&this.stream._duplexState||(this.stream._duplexState&=Ue,this.update())}function ht(){this.stream._duplexState&Me||(this.stream._duplexState&=ze,this.update())}function pt(e){const t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=we),142606351&t._duplexState||(t._duplexState|=Pe),t.emit("open")),t._duplexState&=He,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function bt(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=xe,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=Ie,this._writableState.updateNextTick())}class yt extends de{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",kt.bind(this))),this.on("newListener",bt)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&Ke)}destroy(e){this._duplexState&Ke||(e||(e=fe),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=ye,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class wt extends yt{constructor(e){super(e),this._duplexState|=8519681,this._readableState=new ot(this,e),e&&(!1===this._readableState.readAhead&&(this._duplexState&=Ce),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new he(e),r=this._readableState.map||mt;return this._readableState.map=function(e){const n=t.push(e);return""===n?null:r(n)},this}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=Oe,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(e,t){let r;const n=new wt({...t,read(t){e.next().then(i).then(t.bind(null,null)).catch(t)},predestroy(){r=e.return()},destroy(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}});return n;function i(e){e.done?n.push(null):n.push(e.value)}}static from(e,t){if(xt(r=e)&&r.readable)return e;var r;if(e[nt])return this._fromAsyncIterator(e[nt](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);let n=0;return new wt({...t,read(t){this.push(n===e.length?null:e[n++]),t(null)}})}static isBackpressured(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return!(e._duplexState&_e)}[nt](){const e=this;let t=null,r=null,n=null;return this.on("error",(e=>{t=e})),this.on("readable",(function(){null!==r&&i(e.read())})),this.on("close",(function(){null!==r&&i(null)})),{[nt](){return this},next:()=>new Promise((function(t,o){r=t,n=o;const s=e.read();null!==s?i(s):8&e._duplexState&&i(null)})),return:()=>o(null),throw:e=>o(e)};function i(i){null!==n&&(t?n(t):null!==i||e._duplexState&Le?r({value:i,done:null===i}):n(fe),n=r=null)}function o(t){return e.destroy(t),new Promise(((r,n)=>{if(8&e._duplexState)return r({value:void 0,done:!0});e.once("close",(function(){t?n(t):r({value:void 0,done:!0})}))}))}}}class gt extends yt{constructor(e){super(e),this._duplexState|=16385,this._writableState=new it(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Fe}uncork(){this._duplexState&=Qe,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return!!(146800654&e._duplexState)}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=function(e){return e._writev!==gt.prototype._writev&&e._writev!==_t.prototype._writev}(e)?Math.min(1,t.queue.length):t.queue.length,n=r+(e._duplexState&qe?1:0);return 0===n?Promise.resolve(!0):(null===t.drains&&(t.drains=[]),new Promise((e=>{t.drains.push({writes:n,resolve:e})})))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class _t extends wt{constructor(e){super(e),this._duplexState=1|this._duplexState&Ee,this._writableState=new it(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=Fe}uncork(){this._duplexState&=Qe,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}function mt(e){return e}function St(e){return!!e._readableState||!!e._writableState}function xt(e){return"number"==typeof e._duplexState&&St(e)}function vt(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function Lt(){}function kt(){this.destroy(new Error("Stream aborted."))}var Et=gt,Ot=wt,At=_t;function Tt(e,t={}){if(e instanceof ReadableStream&&e instanceof WritableStream)return new Ct(e,e,t);if(e instanceof ReadableStream)return new Ut(e,t);if(e instanceof WritableStream)return new Nt(e,t);if(e.readable&&e.writable)return new Ct(e.readable,e.writable,t);if(e.readable)return new Ut(e.readable,t);if(e.writable)return new Nt(e.writable,t);throw new Error("fromWeb: Requires at least a readable or writable stream.")}class Ut extends Ot{constructor(e,t){super(t),this._reader=e.getReader(),this._attachErrorHandler()}_attachErrorHandler(){this._reader.closed.catch((e=>{this.destroy(e)}))}async _read(e){try{const{done:t,value:r}=await this._reader.read();t?this.push(null):this.push(r),e()}catch(t){this.destroy(t),e(t)}}_destroy(e){this._reader.releaseLock(),e()}}class Nt extends Et{constructor(e,t){super(t),this._writer=e.getWriter()}async _write(e,t){try{await this._writer.write(e),t()}catch(e){this.destroy(e),t(e)}}async _final(e){try{await this._writer.close(),e()}catch(t){this.destroy(t),e(t)}}_destroy(e){this._writer.releaseLock(),e()}}class Ct extends At{constructor(e,t,r){super(r),this._reader=e.getReader(),this._writer=t.getWriter(),this._attachErrorHandler(),this._handleCompletion()}_attachErrorHandler(){this._reader.closed.catch((e=>{this.destroy(e)})),this._writer.closed.catch((e=>{this.destroy(e)}))}async _read(e){try{const{done:t,value:r}=await this._reader.read();t?this.push(null):this.push(r),e()}catch(t){this.destroy(t),e(t)}}async _write(e,t){try{await this._writer.write(e),t()}catch(e){this.destroy(e),t(e)}}async _final(e){try{await this._writer.close(),e()}catch(t){this.destroy(t),e(t)}}_destroy(e){this._reader.releaseLock(),this._writer.releaseLock(),e()}_handleCompletion(){this.on("finish",(()=>{this.emit("end")}))}}function Mt(e){return!!e._readableState}function Pt(e){return!!e._writableState}const Wt=256<<17;function Rt(e){return new WritableStream({async write(t){try{const r="string"==typeof t?A.from(t):t;e.write(r)||await function(e,t=!1){if(e.destroyed)return Promise.resolve(!1);const r=e._writableState,n=(t?Math.min(1,r.queue.length):r.queue.length)+(e._duplexState&Wt?1:0);return 0===n?Promise.resolve(!0):(null===r.drains&&(r.drains=[]),new Promise((e=>{r.drains.push({writes:n,resolve:e})})))}(e,!1)}catch(t){e.destroy(t),setTimeout((()=>e.emit("error",t)),0)}},async close(){e.end&&e.end()},abort(t){e.destroy&&e.destroy(t),setTimeout((()=>e.emit("error",t)),0)}})}function jt(e,t){let r,n,i;if(e&&!function(e){return"number"==typeof e._duplexState&&function(e){return!!e._readableState||!!e._writableState}(e)}(e)){let t;({readable:e,writable:r,duplex:t}=e),!t||e||r||(e=t,r=t)}else Mt(e)&&Pt(e)?r=e:Mt(e)?r=null:Pt(e)&&(r=e,e=null);if(!e&&!r){throw new Error("Invalid stream")}return e&&(n=function(e){let t=!1;const r={};return new ReadableStream({start(n){r.data=function(r){t||(null===r?i():(n.enqueue("string"==typeof r?A.from(r):r),e.pause()))},r.end=i,r.close=i,r.error=function(e){o(),n.error(e)};for(const t in r)e.on(t,r[t]);function i(){o(),n.close()}function o(){if(!t){t=!0;for(const t in r)e.off(t,r[t])}}e.pause()},pull(){t||e.resume()},cancel(){t=!0;for(const t in r)e.off(t,r[t]);e.destroy?e.destroy():e.close&&e.close()},type:void 0})}(e)),r&&(i=Rt(r)),n&&i?{readable:n,writable:i}:n||i}function It(e,t){if(e instanceof ArrayBuffer&&(e=A.from(e)),A.isBuffer(e))return P.decode(t,e);if(W(e)||R(e)||j(e))return Array.isArray(e)?Tt({readable:e[0],writable:e[1]}):Tt(e);if(Array.isArray(e))return e.map((e=>It(e,t)));if("object"==typeof e&&null!==e){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=It(e[n],t));return r}return e}const Bt="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;function qt(e,t){if(function(e){return e instanceof ArrayBuffer||e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||"undefined"!=typeof WritableStream&&e instanceof WritableStream||j(e)||W(e)||R(e)}(e))return[e];if(r=e,r?._readableState&&r?._writableState){const{readable:t,writable:r}=jt(e);return[t,r]}var r,n;return function(e){return!!e?._readableState}(e)||function(e){return!!e?._writableState}(e)?[jt(e)]:W(e)||R(e)?[e]:Array.isArray(e)&&!A.isBuffer(e)?e.flatMap((e=>qt(e,t))):Bt?[(n=P.encode(t,e),n.buffer.slice(n.byteOffset,n.byteLength+n.byteOffset))]:[P.encode(t,e).buffer]}function Dt(e,t=P.any){return s({send:r=>{if(r.result)r.transfer=qt(r.result,t),r.result=!0;else if(r.params){r.idx=[],r.transfer=[];for(const e of r.params){const n=qt(e,t);r.idx.push(n.length),Array.isArray(n)?r.transfer.push(...n):r.transfer.push(n)}delete r.params}return e.postMessage(r,r.transfer||[])},attach:r=>{const n=e=>{const n=e.data;if(!n.transfer)return r(n);if(!0===n.result)1===n.transfer.length&&(n.transfer=n.transfer[0]),n.result=It(n.transfer,t);else{let e=0;n.params=n.idx.map((r=>{const i=It(n.transfer.slice(e,e+r),t);return e+=r,Array.isArray(i)&&1===i.length?i[0]:i}))}return delete n.transfer,r(n)};return e.addEventListener("message",n),()=>e.removeEventListener("message",n)}})}let Ft=0;"undefined"==typeof navigator&&(globalThis.navigator={hardwareConcurrency:4});var Vt=Object.freeze({__proto__:null,WorkerPool:class{constructor(e,t=Math.max(navigator.hardwareConcurrency/2,4)){this.poolSize=t,this.workers=[],this.taskQueue=[],this.idleWorkers=[],this._terminated=!1;for(let r=0;r<t;r++)this._createWorker(e),Ft++}_createWorker(e){const t=new e,r=Dt(t);t.rpc=r,this.workers.push(t),this.idleWorkers.push(t)}_processQueue(){if(this.taskQueue.length>0&&this.idleWorkers.length>0){const{method:e,resolve:t,reject:r,type:n,args:i=[],worker:o=this.idleWorkers.shift()}=this.taskQueue.shift();"request"===n?o.rpc.request[e](...i).then((e=>{t({result:e,worker:o})})).catch((e=>{r(e)})).finally((()=>{this.idleWorkers.push(o),this._processQueue()})):"notify"===n&&(o.rpc.notify[e](...i),t({worker:o}),this.idleWorkers.push(o),this._processQueue())}}addTaskToWorker(e,t,r=[],n="request"){return this.addTaskComplex(t,r,n,e)}addTask(e,t=[],r="request"){return this.addTaskComplex(e,t,r).then((({result:e})=>e))}addTaskComplex(e,t=[],r="request",n){if(this._terminated)throw new Error("Worker pool has been terminated.");if("request"!==r&&"notify"!==r)throw new Error('Invalid task type. Must be "request" or "notify".');return new Promise(((i,o)=>{this.taskQueue.push({method:e,resolve:i,reject:o,type:r,args:t,worker:n}),this._processQueue()}))}addRequestTask(e,t=[]){return this.addTask(e,t,"request")}addRequestTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"request",e)}addRequestTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"request")}addNotifyTask(e,t=[]){return this.addTask(e,t,"notify")}addNotifyTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"notify",e)}addNotifyTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"notify")}terminateAllWorkers(){this.workers.forEach((e=>{e.terminate(),Ft--})),this.workers=[],this.idleWorkers=[],this._terminated=!0}},get currentWorkerCount(){return Ft}});export{Vt as Pool,Dt as attachRpc,a as rpcFromWebWorker,Dt as rpcFromWebWorkerWithTransfer};
