var t=Object.freeze({__proto__:null,get Pool(){return Me},get attachRpc(){return Pe},get rpcFromWebWorker(){return o},get rpcFromWebWorkerWithTransfer(){return Pe}});function e(t,r=1){return t&&r?e(Object.getPrototypeOf(t),--r).concat(Object.getOwnPropertyNames(t).map((e=>"function"==typeof t[e]?e:null)).filter((t=>t))):[]}class r extends Error{constructor({name:t,message:e}){super(`${t}: ${e} (remote stack)`)}}function n(t){const r={};function n(t,e){r[t]=async(r,n)=>{if("function"==typeof n)try{n(void 0,await e(...r))}catch(t){n(t)}else try{e(...r)}catch(e){console.error(`[rpc-async] method "${t}" caused:`,e)}}}return{on:n,expose:function(r,i){let s=1;i&&r instanceof i&&(s=2);const a=e(r,s);t("expose target:",r);for(const e of a)"function"==typeof r[e]&&(t("expose",r?.constructor?.name,e),n(e,r[e].bind(r)))},handle:function(t,e,n){const i=r[t];"function"!=typeof i&&n(new Error(`No RPC handler for method "${t}"!`)),i(e,n)}}}function i(){const{name:t,debug:e}="undefined"!=typeof process&&process?.pid&&process?.env?{name:`PID:${process.pid}`,debug:!!process.env.DEBUG_RPC}:"undefined"!=typeof window?{name:"MAIN",debug:!!window.DEBUG_RPC}:"undefined"!=typeof self?{name:"WORKER",debug:!!self.DEBUG_RPC}:{name:"UNDEFINED",debug:!1};return e?(...e)=>console.log("[RPC",(new Date).toJSON(),`${t}]`,...e):()=>{}}var s=()=>Math.random().toString(36).slice(2);function a(t){const e="function"==typeof t.log?t.log:i(),{send:a,detach:o}=function(t,e){const r="function"==typeof e.encode?e.encode:t=>t,n="function"==typeof e.decode?e.decode:t=>t;return{send:t=>e.send(r(t)),detach:e.attach((e=>t(n(e))))||(()=>{})}}((function(n){e("route",n);const{id:i,method:s,params:o,result:l,error:h}=n;if(void 0!==s)f(s,o,((t,r)=>{e("route.handle:",s,{id:i,error:t,result:r});try{if(void 0!==i)a({id:i,error:t,result:r});else if(void 0!==t)throw t}catch(t){throw t}}));else{if(void 0===l&&void 0===h){if(e("INVALID Message:",n),t.ignoreInvalidMessages)return;const r=new Error("Invalid RPC message!");throw r.message=n,r}{const t=h?new r(h):void 0;u.dequeue(i,t,l)}}}),t),u=function(t={}){const e=t.defaultTimeout??3e4,r=t.createId??s,n={};return{enqueue:function(t,i=e){return new Promise(((e,s)=>{const a=r(),o=(t,r)=>t?s(t):e(r);n[a]={callback:o,timeout:setTimeout((()=>{o(new Error(`RpcAsync job "${a}" timed out!`)),delete n[a]}),i)},t(a)}))},dequeue:function(t,e,r){const i=n[t];i&&(clearTimeout(i.timeout),i.callback(e,r),delete n[t])},cancel:function(){for(const{callback:t}of Object.values(n))t(new Error("RpcClosing"))}}}(t),{on:l,expose:h,handle:f}=n(e);function d(t,e){a({method:t,params:e})}function c(e,r,n=t.timeout){return u.enqueue((t=>a({id:t,method:e,params:r})),n)}const p=new Proxy({},{get:(t,e,r)=>(...t)=>c(e,t)});return{on:l,expose:h,notify:new Proxy({},{get:(t,e,r)=>(...t)=>d(e,t)}),sendNotification:d,request:p,sendRequest:c,close:function(){o(),u.cancel()}}}function o(t){return a({send:e=>t.postMessage(e),attach:e=>{const r=t=>e(t.data);return t.addEventListener("message",r),()=>t.removeEventListener("message",r)}})}function u(t){return"undefined"!=typeof ReadableStream&&t instanceof ReadableStream}function l(t){return"undefined"!=typeof WritableStream&&t instanceof WritableStream}function h(t){return Array.isArray(t)?2===t.length&&u(t[0])&&l(t[1]):"object"==typeof t&&null!==t&&u(t.readable)&&l(t.writable)}function f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function d(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})})),r}var c,p={exports:{}},b="object"==typeof Reflect?Reflect:null,y=b&&"function"==typeof b.apply?b.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};c=b&&"function"==typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var _=Number.isNaN||function(t){return t!=t};function m(){m.init.call(this)}p.exports=m;var g=p.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,s),n(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}C(t,e,s,{once:!0}),"error"!==e&&function(t,e){"function"==typeof t.on&&C(t,"error",e,{once:!0})}(t,i)}))};m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var w=10;function S(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function x(t){return void 0===t._maxListeners?m.defaultMaxListeners:t._maxListeners}function v(t,e,r,n){var i,s,a,o;if(S(r),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]),void 0===a)a=s[e]=r,++t._eventsCount;else if("function"==typeof a?a=s[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=x(t))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=a.length,o=u,console&&console.warn&&console.warn(o)}return t}function L(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=L.bind(n);return i.listener=r,n.wrapFn=i,i}function E(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):A(i,i.length)}function T(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function A(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function C(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){n.once&&t.removeEventListener(e,i),r(s)}))}}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(t){if("number"!=typeof t||t<0||_(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");w=t}}),m.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||_(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},m.prototype.getMaxListeners=function(){return x(this)},m.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var o=i[t];if(void 0===o)return!1;if("function"==typeof o)y(o,this,e);else{var u=o.length,l=A(o,u);for(r=0;r<u;++r)y(l[r],this,e)}return!0},m.prototype.addListener=function(t,e){return v(this,t,e,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(t,e){return v(this,t,e,!0)},m.prototype.once=function(t,e){return S(e),this.on(t,k(this,t,e)),this},m.prototype.prependOnceListener=function(t,e){return S(e),this.prependListener(t,k(this,t,e)),this},m.prototype.removeListener=function(t,e){var r,n,i,s,a;if(S(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){a=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},m.prototype.listeners=function(t){return E(this,t,!0)},m.prototype.rawListeners=function(t){return E(this,t,!1)},m.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):T.call(t,e)},m.prototype.listenerCount=T,m.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]};var O=p.exports,W=p.exports.EventEmitter,N=p.exports.init,P=p.exports.listenerCount,R=d(Object.freeze({__proto__:null,EventEmitter:W,default:O,init:N,listenerCount:P,once:g})),M="function"==typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t);const U=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};var q=d(t);const{EventEmitter:j}=R,I=new Error("Stream was destroyed"),D=(new Error("Premature close"),M),B=class{constructor(t){this.hwm=t||16,this.head=new U(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new U(2*this.head.buffer.length),this.head.push(t)}}shift(){0!==this.length&&this.length--;const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){const t=this.tail.peek();return void 0===t&&this.tail.next?this.tail.next.peek():t}isEmpty(){return 0===this.length}},F=q,V=536870911,z=1^V,Q=2^V,$=64,H=128,G=256,K=1024,J=2048,X=4096,Y=8192,Z=16384,tt=32768,et=131072,rt=131328,nt=16^V,it=768^V,st=536838143,at=32^V,ot=536739839,ut=2<<18,lt=4<<18,ht=8<<18,ft=16<<18,dt=32<<18,ct=64<<18,pt=128<<18,bt=256<<18,yt=512<<18,_t=1024<<18,mt=469499903,gt=535822335,wt=503316479,St=268435455,xt=262160,vt=536608751,Lt=8404992,kt=14,Et=15,Tt=8405006,At=33587200,Ct=33587215,Ot=2359296,Wt=270794767,Nt=Symbol.asyncIterator||Symbol("asyncIterator");class Pt{constructor(t,{highWaterMark:e=16384,map:r=null,mapWritable:n,byteLength:i,byteLengthWritable:s}={}){this.stream=t,this.queue=new B,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||i||Yt,this.map=n||r,this.afterWrite=It.bind(this),this.afterUpdateNextTick=Ft.bind(this)}get ended(){return!!(this.stream._duplexState&dt)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=ht,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|yt)&gt}autoBatch(t,e){const r=[],n=this.stream;for(r.push(t);(n._duplexState&Wt)===Ot;)r.push(n._writableState.shift());if(n._duplexState&Et)return e(null);n._writev(r,e)}update(){const t=this.stream;t._duplexState|=ut;do{for(;(t._duplexState&Wt)===ht;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite)}1310720&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=536346623}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===yt)return t._duplexState=402653183&t._duplexState|262144,void t._final(qt.bind(this));4!=(t._duplexState&kt)?1==(t._duplexState&Ct)&&(t._duplexState=(t._duplexState|xt)&z,t._open(Vt.bind(this))):t._duplexState&At||(t._duplexState|=xt,t._destroy(jt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&pt)&&(this.stream._duplexState&=wt,!0)}updateCallback(){(35127311&this.stream._duplexState)===lt?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&pt||(this.stream._duplexState|=pt,this.stream._duplexState&ut||D(this.afterUpdateNextTick))}}class Rt{constructor(t,{highWaterMark:e=16384,map:r=null,mapReadable:n,byteLength:i,byteLengthReadable:s}={}){this.stream=t,this.queue=new B,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||i||Yt,this.map=n||r,this.pipeTo=null,this.afterRead=Dt.bind(this),this.afterUpdateNextTick=Bt.bind(this)}get ended(){return!!(this.stream._duplexState&Z)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new Mt(this.stream,t,e),e&&this.stream.on("error",Zt),Xt(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Zt),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const e=this.pipeline.done.bind(this.pipeline,t),r=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",r),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Ut.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&e._duplexState|1024,!1):(null!==this.map&&null===(t=this.map(t))||(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=536805375&e._duplexState|128),this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const r=e[t];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(e[e.length-1])}read(){const t=this.stream;if((16527&t._duplexState)===H){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=it),t._duplexState&J&&t.emit("data",e),e}return!1===this.readAhead&&(t._duplexState|=et,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===H&&768&t._duplexState;){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=it),t._duplexState&J&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===et;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=Y,t.emit("readable")),80&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=at}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===K&&(t._duplexState=536869887&t._duplexState|16384,t.emit("end"),(t._duplexState&Tt)===Lt&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&kt)?1==(t._duplexState&Ct)&&(t._duplexState=(t._duplexState|xt)&z,t._open(Vt.bind(this))):t._duplexState&At||(t._duplexState|=xt,t._destroy(jt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&tt)&&(this.stream._duplexState&=st,!0)}updateCallback(){(32879&this.stream._duplexState)===$?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&tt||(this.stream._duplexState|=tt,32&this.stream._duplexState||D(this.afterUpdateNextTick))}}class Mt{constructor(t,e,r){this.from=t,this.to=e,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):t._duplexState&Z||this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&Z&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function Ut(){this.stream._duplexState|=512,this.updateCallback()}function qt(t){const e=this.stream;t&&e.destroy(t),e._duplexState&kt||(e._duplexState|=dt,e.emit("finish")),(e._duplexState&Tt)===Lt&&(e._duplexState|=4),e._duplexState&=mt,e._duplexState&ut?this.updateNextTick():this.update()}function jt(t){const e=this.stream;t||this.error===I||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const r=e._readableState,n=e._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(e,t),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(e,t)}}function It(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=mt,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--)}(this.drains),(6553615&e._duplexState)===ft&&(e._duplexState&=532676607,(e._duplexState&ct)===ct&&e.emit("drain")),this.updateCallback()}function Dt(t){t&&this.stream.destroy(t),this.stream._duplexState&=nt,!1!==this.readAhead||this.stream._duplexState&G||(this.stream._duplexState&=ot),this.updateCallback()}function Bt(){32&this.stream._duplexState||(this.stream._duplexState&=st,this.update())}function Ft(){this.stream._duplexState&ut||(this.stream._duplexState&=wt,this.update())}function Vt(t){const e=this.stream;t&&e.destroy(t),4&e._duplexState||(17423&e._duplexState||(e._duplexState|=$),142606351&e._duplexState||(e._duplexState|=lt),e.emit("open")),e._duplexState&=vt,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback()}function zt(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=X,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=ct,this._writableState.updateNextTick())}class Qt extends j{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",te.bind(this))),this.on("newListener",zt)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&kt)}destroy(t){this._duplexState&kt||(t||(t=I),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=Q,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class $t extends Qt{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new Rt(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=ot),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new F(t),r=this._readableState.map||Kt;return this._readableState.map=function(t){const n=e.push(t);return""===n?null:r(n)},this}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=rt,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let r;const n=new $t({...e,read(e){t.next().then(i).then(e.bind(null,null)).catch(e)},predestroy(){r=t.return()},destroy(t){if(!r)return t(null);r.then(t.bind(null,null)).catch(t)}});return n;function i(t){t.done?n.push(null):n.push(t.value)}}static from(t,e){if(Xt(r=t)&&r.readable)return t;var r;if(t[Nt])return this._fromAsyncIterator(t[Nt](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let n=0;return new $t({...e,read(e){this.push(n===t.length?null:t[n++]),e(null)}})}static isBackpressured(t){return!!(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return!(t._duplexState&G)}[Nt](){const t=this;let e=null,r=null,n=null;return this.on("error",(t=>{e=t})),this.on("readable",(function(){null!==r&&i(t.read())})),this.on("close",(function(){null!==r&&i(null)})),{[Nt](){return this},next:()=>new Promise((function(e,s){r=e,n=s;const a=t.read();null!==a?i(a):8&t._duplexState&&i(null)})),return:()=>s(null),throw:t=>s(t)};function i(i){null!==n&&(e?n(e):null!==i||t._duplexState&Z?r({value:i,done:null===i}):n(I),n=r=null)}function s(e){return t.destroy(e),new Promise(((r,n)=>{if(8&t._duplexState)return r({value:void 0,done:!0});t.once("close",(function(){e?n(e):r({value:void 0,done:!0})}))}))}}}class Ht extends Qt{constructor(t){super(t),this._duplexState|=16385,this._writableState=new Pt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=_t}uncork(){this._duplexState&=St,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return!!(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,r=function(t){return t._writev!==Ht.prototype._writev&&t._writev!==Gt.prototype._writev}(t)?Math.min(1,e.queue.length):e.queue.length,n=r+(t._duplexState&bt?1:0);return 0===n?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:n,resolve:t})})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class Gt extends $t{constructor(t){super(t),this._duplexState=1|this._duplexState&et,this._writableState=new Pt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=_t}uncork(){this._duplexState&=St,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}function Kt(t){return t}function Jt(t){return!!t._readableState||!!t._writableState}function Xt(t){return"number"==typeof t._duplexState&&Jt(t)}function Yt(t){return function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Zt(){}function te(){this.destroy(new Error("Stream aborted."))}var ee=Ht,re=$t,ne=Gt;function ie(t,e={}){if(t instanceof ReadableStream&&t instanceof WritableStream)return new oe(t,t,e);if(t instanceof ReadableStream)return new se(t,e);if(t instanceof WritableStream)return new ae(t,e);if(t.readable&&t.writable)return new oe(t.readable,t.writable,e);if(t.readable)return new se(t.readable,e);if(t.writable)return new ae(t.writable,e);throw new Error("fromWeb: Requires at least a readable or writable stream.")}class se extends re{constructor(t,e){super(e),this._reader=t.getReader(),this._attachErrorHandler()}_attachErrorHandler(){this._reader.closed.catch((t=>{this.destroy(t)}))}async _read(t){try{const{done:e,value:r}=await this._reader.read();e?this.push(null):this.push(r),t()}catch(e){this.destroy(e),t(e)}}_destroy(t){this._reader.releaseLock(),t()}}class ae extends ee{constructor(t,e){super(e),this._writer=t.getWriter()}async _write(t,e){try{await this._writer.write(t),e()}catch(t){this.destroy(t),e(t)}}async _final(t){try{await this._writer.close(),t()}catch(e){this.destroy(e),t(e)}}_destroy(t){this._writer.releaseLock(),t()}}class oe extends ne{constructor(t,e,r){super(r),this._reader=t.getReader(),this._writer=e.getWriter(),this._attachErrorHandler(),this._handleCompletion()}_attachErrorHandler(){this._reader.closed.catch((t=>{this.destroy(t)})),this._writer.closed.catch((t=>{this.destroy(t)}))}async _read(t){try{const{done:e,value:r}=await this._reader.read();e?this.push(null):this.push(r),t()}catch(e){this.destroy(e),t(e)}}async _write(t,e){try{await this._writer.write(t),e()}catch(t){this.destroy(t),e(t)}}async _final(t){try{await this._writer.close(),t()}catch(e){this.destroy(e),t(e)}}_destroy(t){this._reader.releaseLock(),this._writer.releaseLock(),t()}_handleCompletion(){this.on("finish",(()=>{this.emit("end")}))}}function ue(t){return!!t._readableState}function le(t){return!!t._writableState}const he=256<<17;var fe={exports:{}};function de(t){return t.length}var ce={byteLength:de,toString:function(t){const e=t.byteLength;let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r},write:function(t,e,r=0,n=de(e)){const i=Math.min(n,t.byteLength-r);for(let n=0;n<i;n++)t[r+n]=e.charCodeAt(n);return i}};const pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be=new Uint8Array(256);for(let t=0;t<64;t++)be[pe.charCodeAt(t)]=t;function ye(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}be[45]=62,be[95]=63;var _e={byteLength:ye,toString:function(t){const e=t.byteLength;let r="";for(let n=0;n<e;n+=3)r+=pe[t[n]>>2]+pe[(3&t[n])<<4|t[n+1]>>4]+pe[(15&t[n+1])<<2|t[n+2]>>6]+pe[63&t[n+2]];return e%3==2?r=r.substring(0,r.length-1)+"=":e%3==1&&(r=r.substring(0,r.length-2)+"=="),r},write:function(t,e,r=0,n=ye(e)){const i=Math.min(n,t.byteLength-r);for(let r=0,n=0;n<i;r+=4){const i=be[e.charCodeAt(r)],s=be[e.charCodeAt(r+1)],a=be[e.charCodeAt(r+2)],o=be[e.charCodeAt(r+3)];t[n++]=i<<2|s>>4,t[n++]=(15&s)<<4|a>>2,t[n++]=(3&a)<<6|63&o}return i}};function me(t){return t.length>>>1}var ge={byteLength:me,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let r="",n=0;for(let i=e-e%4;n<i;n+=4)r+=t.getUint32(n).toString(16).padStart(8,"0");for(;n<e;n++)r+=t.getUint8(n).toString(16).padStart(2,"0");return r},write:function(t,e,r=0,n=me(e)){const i=Math.min(n,t.byteLength-r);for(let n=0;n<i;n++){const i=we(e.charCodeAt(2*n)),s=we(e.charCodeAt(2*n+1));if(void 0===i||void 0===s)return t.subarray(0,n);t[r+n]=i<<4|s}return i}};function we(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function Se(t){let e=0;for(let r=0,n=t.length;r<n;r++){const i=t.charCodeAt(r);if(i>=55296&&i<=56319&&r+1<n){const n=t.charCodeAt(r+1);if(n>=56320&&n<=57343){e+=4,r++;continue}}e+=i<=127?1:i<=2047?2:3}return e}let xe,ve;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;xe=function(e){return t.decode(e)}}else xe=function(t){const e=t.byteLength;let r="",n=0;for(;n<e;){let i=t[n];if(i<=127){r+=String.fromCharCode(i),n++;continue}let s=0,a=0;if(i<=223?(s=1,a=31&i):i<=239?(s=2,a=15&i):i<=244&&(s=3,a=7&i),e-n-s>0){let e=0;for(;e<s;)i=t[n+e+1],a=a<<6|63&i,e+=1}else a=65533,s=e-n;r+=String.fromCodePoint(a),n+=s+1}return r};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;ve=function(e,r,n=0,i=Se(r)){const s=Math.min(i,e.byteLength-n);return t.encodeInto(r,e.subarray(n,n+s)),s}}else ve=function(t,e,r=0,n=Se(e)){const i=Math.min(n,t.byteLength-r);t=t.subarray(r,r+i);let s=0,a=0;for(;s<e.length;){const r=e.codePointAt(s);if(r<=127){t[a++]=r,s++;continue}let n=0,i=0;for(r<=2047?(n=6,i=192):r<=65535?(n=12,i=224):r<=2097151&&(n=18,i=240),t[a++]=i|r>>n,n-=6;n>=0;)t[a++]=128|r>>n&63,n-=6;s+=r>=65536?2:1}return i};var Le={byteLength:Se,toString:xe,write:ve};function ke(t){return 2*t.length}var Ee={byteLength:ke,toString:function(t){const e=t.byteLength;let r="";for(let n=0;n<e-1;n+=2)r+=String.fromCharCode(t[n]+256*t[n+1]);return r},write:function(t,e,r=0,n=ke(e)){const i=Math.min(n,t.byteLength-r);let s=i;for(let n=0;n<e.length&&!((s-=2)<0);++n){const i=e.charCodeAt(n),s=i>>8,a=i%256;t[r+2*n]=a,t[r+2*n+1]=s}return i}};!function(t,e){const r=ce,n=_e,i=ge,s=Le,a=Ee,o=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function u(t){switch(t){case"ascii":return r;case"base64":return n;case"hex":return i;case"utf8":case"utf-8":case void 0:return s;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a;default:throw new Error(`Unknown encoding: ${t}`)}}function l(t){return t instanceof Uint8Array}function h(t,e,r){return"string"==typeof t?function(t,e){const r=u(e),n=new Uint8Array(r.byteLength(t));return r.write(n,t,0,n.byteLength),n}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,r){return new Uint8Array(t,e,r)}(t,e,r)}function f(t,e,r,n,i){if(0===t.byteLength)return-1;if("string"==typeof r?(n=r,r=0):void 0===r?r=i?0:t.length-1:r<0&&(r+=t.byteLength),r>=t.byteLength){if(i)return-1;r=t.byteLength-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e)e=h(e,n);else if("number"==typeof e)return e&=255,i?t.indexOf(e,r):t.lastIndexOf(e,r);if(0===e.byteLength)return-1;if(i){let n=-1;for(let i=r;i<t.byteLength;i++)if(t[i]===e[-1===n?0:i-n]){if(-1===n&&(n=i),i-n+1===e.byteLength)return n}else-1!==n&&(i-=i-n),n=-1}else{r+e.byteLength>t.byteLength&&(r=t.byteLength-e.byteLength);for(let n=r;n>=0;n--){let r=!0;for(let i=0;i<e.byteLength;i++)if(t[n+i]!==e[i]){r=!1;break}if(r)return n}}return-1}function d(t,e,r,n){return f(t,e,r,n,!0)}function c(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}t.exports=e={isBuffer:l,isEncoding:function(t){try{return u(t),!0}catch{return!1}},alloc:function(t,r,n){const i=new Uint8Array(t);return void 0!==r&&e.fill(i,r,0,i.byteLength,n),i},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return u(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const r=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=0;for(let i=r-r%4;n<i;n+=4){if(t.getUint32(n,o)!==e.getUint32(n,o))break}for(;n<r;n++){const r=t.getUint8(n),i=e.getUint8(n);if(r<i)return-1;if(r>i)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const r=new Uint8Array(e);let n=0;for(const e of t){if(n+e.byteLength>r.byteLength){const t=e.subarray(0,r.byteLength-n);return r.set(t,n),r}r.set(e,n),n+=e.byteLength}return r},copy:function(t,e,r=0,n=0,i=t.byteLength){if(i>0&&i<n)return 0;if(i===n)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(r<0)throw new RangeError("targetStart is out of range");if(n<0||n>=t.byteLength)throw new RangeError("sourceStart is out of range");if(i<0)throw new RangeError("sourceEnd is out of range");r>=e.byteLength&&(r=e.byteLength),i>t.byteLength&&(i=t.byteLength),e.byteLength-r<i-n&&(i=e.length-r+n);const s=i-n;return t===e?e.copyWithin(r,n,i):e.set(t.subarray(n,i),r),s},equals:function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;const r=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=0;for(let i=r-r%4;n<i;n+=4)if(t.getUint32(n,o)!==e.getUint32(n,o))return!1;for(;n<r;n++)if(t.getUint8(n)!==e.getUint8(n))return!1;return!0},fill:function(t,e,r,n,i){if("string"==typeof e?"string"==typeof r?(i=r,r=0,n=t.byteLength):"string"==typeof n&&(i=n,n=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),r<0||t.byteLength<r||t.byteLength<n)throw new RangeError("Out of range index");if(void 0===r&&(r=0),void 0===n&&(n=t.byteLength),n<=r)return t;if(e||(e=0),"number"==typeof e)for(let i=r;i<n;++i)t[i]=e;else{const s=(e=l(e)?e:h(e,i)).byteLength;for(let i=0;i<n-r;++i)t[i+r]=e[i%s]}return t},from:h,includes:function(t,e,r,n){return-1!==d(t,e,r,n)},indexOf:d,lastIndexOf:function(t,e,r,n){return f(t,e,r,n,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<e;r+=2)c(t,r,r+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<e;r+=4)c(t,r,r+3),c(t,r+1,r+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<e;r+=8)c(t,r,r+7),c(t,r+1,r+6),c(t,r+2,r+5),c(t,r+3,r+4);return t},toBuffer:function(t){return t},toString:function(t,e,r=0,n=t.byteLength){const i=t.byteLength;return r>=i||n<=r?"":(r<0&&(r=0),n>i&&(n=i),(0!==r||n<i)&&(t=t.subarray(r,n)),u(e).toString(t))},write:function(t,e,r,n,i){return void 0===r?i="utf8":void 0===n&&"string"==typeof r?(i=r,r=void 0):void 0===i&&"string"==typeof n&&(i=n,n=void 0),u(i).write(t,e,r,n)},writeDoubleLE:function(t,e,r){return void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),r+8},writeFloatLE:function(t,e,r){return void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),r+4},writeUInt32LE:function(t,e,r){return void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(r,e,!0),r+4},writeInt32LE:function(t,e,r){return void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(r,e,!0),r+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}}}(fe,fe.exports);var Te=f(fe.exports);function Ae(t){return new WritableStream({async write(e){try{const r="string"==typeof e?Te.from(e):e;t.write(r)||await function(t,e=!1){if(t.destroyed)return Promise.resolve(!1);const r=t._writableState,n=(e?Math.min(1,r.queue.length):r.queue.length)+(t._duplexState&he?1:0);return 0===n?Promise.resolve(!0):(null===r.drains&&(r.drains=[]),new Promise((t=>{r.drains.push({writes:n,resolve:t})})))}(t,!1)}catch(e){t.destroy(e),setTimeout((()=>t.emit("error",e)),0)}},async close(){t.end&&t.end()},abort(e){t.destroy&&t.destroy(e),setTimeout((()=>t.emit("error",e)),0)}})}function Ce(t,e){let r,n,i;if(t&&!function(t){return"number"==typeof t._duplexState&&function(t){return!!t._readableState||!!t._writableState}(t)}(t)){let e;({readable:t,writable:r,duplex:e}=t),!e||t||r||(t=e,r=e)}else ue(t)&&le(t)?r=t:ue(t)?r=null:le(t)&&(r=t,t=null);if(!t&&!r){throw new Error("Invalid stream")}return t&&(n=function(t){let e=!1;const r={};return new ReadableStream({start(n){r.data=function(r){e||(null===r?i():(n.enqueue("string"==typeof r?Te.from(r):r),t.pause()))},r.end=i,r.close=i,r.error=function(t){s(),n.error(t)};for(const e in r)t.on(e,r[e]);function i(){s(),n.close()}function s(){if(!e){e=!0;for(const e in r)t.off(e,r[e])}}t.pause()},pull(){e||t.resume()},cancel(){e=!0;for(const e in r)t.off(e,r[e]);t.destroy?t.destroy():t.close&&t.close()},type:void 0})}(t)),r&&(i=Ae(r)),n&&i?{readable:n,writable:i}:n||i}function Oe(t,e){const r=function t(r){if(r instanceof ArrayBuffer&&(r=Te.from(r)),Te.isBuffer(r))return r;if("string"==typeof r&&r.startsWith("__fn_")){const t=r,n=(...r)=>e.request[t](...r);return n.notify=function(...r){e.notify[t](...r)},n}if(u(r)||l(r)||h(r))return Array.isArray(r)&&2===r.length?ie({readable:r[0],writable:r[1]}):ie(r);if(Array.isArray(r)){const e=r.map((e=>t(e)));return 1===e.length?e[0]:e}if("object"==typeof r&&null!==r){const e={};for(const n in r)e[n]=t(r[n]);return e}return r}(t);return Array.isArray(r)&&1===r.length?r[0]:r}const We="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;function Ne(t,e,r=null){const n=new Map;function i(t){const e=Array.isArray(t)?t:[t];return r&&e.forEach((t=>{if(!n.has(t)){const e=r.transfer.length;r.idx.push(e),r.transfer.push(t),n.set(t,e)}})),t}function s(t){if(Te.isBuffer(t))return i(We?(r=t).buffer.slice(r.byteOffset,r.byteLength+r.byteOffset):Te.from(t).buffer);var r,n;if("function"==typeof t)return function(t,e){const r=`__fn_${Math.random().toString(36).substring(2,9)}`;return t.expose({[r]:e}),r}(e,t);if(n=t,n?._readableState&&n?._writableState){const e=Ce(t);return i([e.readable,e.writable])}if(function(t){return!!t?._readableState}(t)||function(t){return!!t?._writableState}(t))return i(Ce(t));if(function(t){return t instanceof ArrayBuffer||t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||"undefined"!=typeof WritableStream&&t instanceof WritableStream||h(t)||u(t)||l(t)}(t))return i(t);if("object"==typeof t&&null!==t){const e={};for(const r in t)e[r]=s(t[r]);return e}return t}return Array.isArray(t)?t.map(s):s(t)}function Pe(t){const e=a({send:r=>(r.idx=[],r.transfer=[],r.method?r.params=Ne(r.params,e,r):r.result=Ne(r.result,e,r),t.postMessage(r,r.transfer||[])),attach:r=>{const n=t=>{const n=t.data;return n.method?(n.params=Oe(n.params,e),Array.isArray(n.params)||(n.params=[n.params])):n.result=Oe(n.result,e)??null,delete n.transfer,r(n)};return t.addEventListener("message",n),()=>t.removeEventListener("message",n)}});return e.emit=e.sendNotification.bind(e),e}let Re=0;"undefined"==typeof navigator&&(globalThis.navigator={hardwareConcurrency:4});var Me=Object.freeze({__proto__:null,WorkerPool:class{constructor(t,e=Math.max(navigator.hardwareConcurrency/2,4)){this.poolSize=e,this.workers=[],this.taskQueue=[],this.idleWorkers=[],this._terminated=!1;for(let r=0;r<e;r++)this._createWorker(t),Re++}_createWorker(t){const e=new t,r=Pe(e);e.rpc=r,this.workers.push(e),this.idleWorkers.push(e)}_processQueue(){if(this.taskQueue.length>0&&this.idleWorkers.length>0){const{method:t,resolve:e,reject:r,type:n,args:i=[],worker:s=this.idleWorkers.shift()}=this.taskQueue.shift();"request"===n?s.rpc.request[t](...i).then((t=>{e({result:t,worker:s})})).catch((t=>{r(t)})).finally((()=>{this.idleWorkers.push(s),this._processQueue()})):"notify"===n&&(s.rpc.notify[t](...i),e({worker:s}),this.idleWorkers.push(s),this._processQueue())}}addTaskToWorker(t,e,r=[],n="request"){return this.addTaskComplex(e,r,n,t)}addTask(t,e=[],r="request"){return this.addTaskComplex(t,e,r).then((({result:t})=>t))}addTaskComplex(t,e=[],r="request",n){if(this._terminated)throw new Error("Worker pool has been terminated.");if("request"!==r&&"notify"!==r)throw new Error('Invalid task type. Must be "request" or "notify".');return new Promise(((i,s)=>{this.taskQueue.push({method:t,resolve:i,reject:s,type:r,args:e,worker:n}),this._processQueue()}))}addRequestTask(t,e=[]){return this.addTask(t,e,"request")}addRequestTaskToWorker(t,e,r=[]){return this.addTaskComplex(e,r,"request",t)}addRequestTaskComplex(t,e=[]){return this.addTaskComplex(t,e,"request")}addNotifyTask(t,e=[]){return this.addTask(t,e,"notify")}addNotifyTaskToWorker(t,e,r=[]){return this.addTaskComplex(e,r,"notify",t)}addNotifyTaskComplex(t,e=[]){return this.addTaskComplex(t,e,"notify")}terminateAllWorkers(){this.workers.forEach((t=>{t.terminate(),Re--})),this.workers=[],this.idleWorkers=[],this._terminated=!0}},get currentWorkerCount(){return Re}});export{Me as Pool,Pe as attachRpc,o as rpcFromWebWorker,Pe as rpcFromWebWorkerWithTransfer};
