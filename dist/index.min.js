function e(t,r=1){return t&&r?e(Object.getPrototypeOf(t),--r).concat(Object.getOwnPropertyNames(t).map((e=>"function"==typeof t[e]?e:null)).filter((e=>e))):[]}class t extends Error{constructor({name:e,message:t}){super(`${e}: ${t} (remote stack)`)}}function r(t){const r={};function n(e,t){r[e]=async(r,n)=>{if("function"==typeof n)try{n(void 0,await t(...r))}catch(e){n(e)}else try{t(...r)}catch(t){console.error(`[rpc-async] method "${e}" caused:`,t)}}}return{on:n,expose:function(r,s){let i=1;s&&r instanceof s&&(i=2);const o=e(r,i);t("expose target:",r);for(const e of o)"function"==typeof r[e]&&(t("expose",r?.constructor?.name,e),n(e,r[e].bind(r)))},handle:function(e,t,n){const s=r[e];"function"!=typeof s&&n(new Error(`No RPC handler for method "${e}"!`)),s(t,n)}}}function n(){const{name:e,debug:t}="undefined"!=typeof process&&process?.pid&&process?.env?{name:`PID:${process.pid}`,debug:!!process.env.DEBUG_RPC}:"undefined"!=typeof window?{name:"MAIN",debug:!!window.DEBUG_RPC}:"undefined"!=typeof self?{name:"WORKER",debug:!!self.DEBUG_RPC}:{name:"UNDEFINED",debug:!1};return t?(...t)=>console.log("[RPC",(new Date).toJSON(),`${e}]`,...t):()=>{}}var s=()=>Math.random().toString(36).slice(2);function i(e){const i="function"==typeof e.log?e.log:n(),{send:o,detach:a}=function(e,t){const r="function"==typeof t.encode?t.encode:e=>e,n="function"==typeof t.decode?t.decode:e=>e;return{send:e=>t.send(r(e)),detach:t.attach((t=>e(n(t))))||(()=>{})}}((function(r){i("route",r);const{id:n,method:s,params:a,result:f,error:d}=r;if(void 0!==s)l(s,a,((e,t)=>{i("route.handle:",s,{id:n,error:e,result:t});try{if(void 0!==n)o({id:n,error:e,result:t});else if(void 0!==e)throw e}catch(e){throw e}}));else{if(void 0===f&&void 0===d){if(i("INVALID Message:",r),e.ignoreInvalidMessages)return;const t=new Error("Invalid RPC message!");throw t.message=r,t}{const e=d?new t(d):void 0;u.dequeue(n,e,f)}}}),e),u=function(e={}){const t=e.defaultTimeout??3e4,r=e.createId??s,n={};return{enqueue:function(e,s=t){return new Promise(((t,i)=>{const o=r(),a=(e,r)=>e?i(e):t(r);n[o]={callback:a,timeout:setTimeout((()=>{a(new Error(`RpcAsync job "${o}" timed out!`)),delete n[o]}),s)},e(o)}))},dequeue:function(e,t,r){const s=n[e];s&&(clearTimeout(s.timeout),s.callback(t,r),delete n[e])},cancel:function(){for(const{callback:e}of Object.values(n))e(new Error("RpcClosing"))}}}(e),{on:f,expose:d,handle:l}=r(i);function c(e,t){o({method:e,params:t})}function h(t,r,n=e.timeout){return u.enqueue((e=>o({id:e,method:t,params:r})),n)}const p=new Proxy({},{get:(e,t,r)=>(...e)=>h(t,e)});return{on:f,expose:d,notify:new Proxy({},{get:(e,t,r)=>(...e)=>c(t,e)}),sendNotification:c,request:p,sendRequest:h,close:function(){a(),u.cancel()}}}function o(e){return i({send:t=>e.postMessage(t),attach:t=>{const r=e=>t(e.data);return e.addEventListener("message",r),()=>e.removeEventListener("message",r)}})}function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function u(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var f={},d={exports:{}};function l(e){return e.length}var c={byteLength:l,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r},write:function(e,t,r=0,n=l(t)){const s=Math.min(n,e.byteLength-r);for(let n=0;n<s;n++)e[r+n]=t.charCodeAt(n);return s}};const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=new Uint8Array(256);for(let e=0;e<64;e++)p[h.charCodeAt(e)]=e;function b(e){let t=e.length;return 61===e.charCodeAt(t-1)&&t--,t>1&&61===e.charCodeAt(t-1)&&t--,3*t>>>2}p[45]=62,p[95]=63;var y={byteLength:b,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t;n+=3)r+=h[e[n]>>2]+h[(3&e[n])<<4|e[n+1]>>4]+h[(15&e[n+1])<<2|e[n+2]>>6]+h[63&e[n+2]];return t%3==2?r=r.substring(0,r.length-1)+"=":t%3==1&&(r=r.substring(0,r.length-2)+"=="),r},write:function(e,t,r=0,n=b(t)){const s=Math.min(n,e.byteLength-r);for(let r=0,n=0;n<s;r+=4){const s=p[t.charCodeAt(r)],i=p[t.charCodeAt(r+1)],o=p[t.charCodeAt(r+2)],a=p[t.charCodeAt(r+3)];e[n++]=s<<2|i>>4,e[n++]=(15&i)<<4|o>>2,e[n++]=(3&o)<<6|63&a}return s}};function w(e){return e.length>>>1}var g={byteLength:w,toString:function(e){const t=e.byteLength;e=new DataView(e.buffer,e.byteOffset,t);let r="",n=0;for(let s=t-t%4;n<s;n+=4)r+=e.getUint32(n).toString(16).padStart(8,"0");for(;n<t;n++)r+=e.getUint8(n).toString(16).padStart(2,"0");return r},write:function(e,t,r=0,n=w(t)){const s=Math.min(n,e.byteLength-r);for(let n=0;n<s;n++){const s=m(t.charCodeAt(2*n)),i=m(t.charCodeAt(2*n+1));if(void 0===s||void 0===i)return e.subarray(0,n);e[r+n]=s<<4|i}return s}};function m(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:void 0}function _(e){let t=0;for(let r=0,n=e.length;r<n;r++){const s=e.charCodeAt(r);if(s>=55296&&s<=56319&&r+1<n){const n=e.charCodeAt(r+1);if(n>=56320&&n<=57343){t+=4,r++;continue}}t+=s<=127?1:s<=2047?2:3}return t}let S,x;if("undefined"!=typeof TextDecoder){const e=new TextDecoder;S=function(t){return e.decode(t)}}else S=function(e){const t=e.byteLength;let r="",n=0;for(;n<t;){let s=e[n];if(s<=127){r+=String.fromCharCode(s),n++;continue}let i=0,o=0;if(s<=223?(i=1,o=31&s):s<=239?(i=2,o=15&s):s<=244&&(i=3,o=7&s),t-n-i>0){let t=0;for(;t<i;)s=e[n+t+1],o=o<<6|63&s,t+=1}else o=65533,i=t-n;r+=String.fromCodePoint(o),n+=i+1}return r};if("undefined"!=typeof TextEncoder){const e=new TextEncoder;x=function(t,r,n=0,s=_(r)){const i=Math.min(s,t.byteLength-n);return e.encodeInto(r,t.subarray(n,n+i)),i}}else x=function(e,t,r=0,n=_(t)){const s=Math.min(n,e.byteLength-r);e=e.subarray(r,r+s);let i=0,o=0;for(;i<t.length;){const r=t.codePointAt(i);if(r<=127){e[o++]=r,i++;continue}let n=0,s=0;for(r<=2047?(n=6,s=192):r<=65535?(n=12,s=224):r<=2097151&&(n=18,s=240),e[o++]=s|r>>n,n-=6;n>=0;)e[o++]=128|r>>n&63,n-=6;i+=r>=65536?2:1}return s};var v={byteLength:_,toString:S,write:x};function L(e){return 2*e.length}var k={byteLength:L,toString:function(e){const t=e.byteLength;let r="";for(let n=0;n<t-1;n+=2)r+=String.fromCharCode(e[n]+256*e[n+1]);return r},write:function(e,t,r=0,n=L(t)){const s=Math.min(n,e.byteLength-r);let i=s;for(let n=0;n<t.length&&!((i-=2)<0);++n){const s=t.charCodeAt(n),i=s>>8,o=s%256;e[r+2*n]=o,e[r+2*n+1]=i}return s}};!function(e,t){const r=c,n=y,s=g,i=v,o=k,a=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function u(e){switch(e){case"ascii":return r;case"base64":return n;case"hex":return s;case"utf8":case"utf-8":case void 0:return i;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o;default:throw new Error(`Unknown encoding: ${e}`)}}function f(e){return e instanceof Uint8Array}function d(e,t,r){return"string"==typeof e?function(e,t){const r=u(t),n=new Uint8Array(r.byteLength(e));return r.write(n,e,0,n.byteLength),n}(e,t):Array.isArray(e)?function(e){const t=new Uint8Array(e.length);return t.set(e),t}(e):ArrayBuffer.isView(e)?function(e){const t=new Uint8Array(e.byteLength);return t.set(e),t}(e):function(e,t,r){return new Uint8Array(e,t,r)}(e,t,r)}function l(e,t,r,n,s){if(0===e.byteLength)return-1;if("string"==typeof r?(n=r,r=0):void 0===r?r=s?0:e.length-1:r<0&&(r+=e.byteLength),r>=e.byteLength){if(s)return-1;r=e.byteLength-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t)t=d(t,n);else if("number"==typeof t)return t&=255,s?e.indexOf(t,r):e.lastIndexOf(t,r);if(0===t.byteLength)return-1;if(s){let n=-1;for(let s=r;s<e.byteLength;s++)if(e[s]===t[-1===n?0:s-n]){if(-1===n&&(n=s),s-n+1===t.byteLength)return n}else-1!==n&&(s-=s-n),n=-1}else{r+t.byteLength>e.byteLength&&(r=e.byteLength-t.byteLength);for(let n=r;n>=0;n--){let r=!0;for(let s=0;s<t.byteLength;s++)if(e[n+s]!==t[s]){r=!1;break}if(r)return n}}return-1}function h(e,t,r,n){return l(e,t,r,n,!0)}function p(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}e.exports=t={isBuffer:f,isEncoding:function(e){try{return u(e),!0}catch{return!1}},alloc:function(e,r,n){const s=new Uint8Array(e);return void 0!==r&&t.fill(s,r,0,s.byteLength,n),s},allocUnsafe:function(e){return new Uint8Array(e)},allocUnsafeSlow:function(e){return new Uint8Array(e)},byteLength:function(e,t){return u(t).byteLength(e)},compare:function(e,t){if(e===t)return 0;const r=Math.min(e.byteLength,t.byteLength);e=new DataView(e.buffer,e.byteOffset,e.byteLength),t=new DataView(t.buffer,t.byteOffset,t.byteLength);let n=0;for(let s=r-r%4;n<s;n+=4){if(e.getUint32(n,a)!==t.getUint32(n,a))break}for(;n<r;n++){const r=e.getUint8(n),s=t.getUint8(n);if(r<s)return-1;if(r>s)return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0},concat:function(e,t){void 0===t&&(t=e.reduce(((e,t)=>e+t.byteLength),0));const r=new Uint8Array(t);let n=0;for(const t of e){if(n+t.byteLength>r.byteLength){const e=t.subarray(0,r.byteLength-n);return r.set(e,n),r}r.set(t,n),n+=t.byteLength}return r},copy:function(e,t,r=0,n=0,s=e.byteLength){if(s>0&&s<n)return 0;if(s===n)return 0;if(0===e.byteLength||0===t.byteLength)return 0;if(r<0)throw new RangeError("targetStart is out of range");if(n<0||n>=e.byteLength)throw new RangeError("sourceStart is out of range");if(s<0)throw new RangeError("sourceEnd is out of range");r>=t.byteLength&&(r=t.byteLength),s>e.byteLength&&(s=e.byteLength),t.byteLength-r<s-n&&(s=t.length-r+n);const i=s-n;return e===t?t.copyWithin(r,n,s):t.set(e.subarray(n,s),r),i},equals:function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;const r=e.byteLength;e=new DataView(e.buffer,e.byteOffset,e.byteLength),t=new DataView(t.buffer,t.byteOffset,t.byteLength);let n=0;for(let s=r-r%4;n<s;n+=4)if(e.getUint32(n,a)!==t.getUint32(n,a))return!1;for(;n<r;n++)if(e.getUint8(n)!==t.getUint8(n))return!1;return!0},fill:function(e,t,r,n,s){if("string"==typeof t?"string"==typeof r?(s=r,r=0,n=e.byteLength):"string"==typeof n&&(s=n,n=e.byteLength):"number"==typeof t?t&=255:"boolean"==typeof t&&(t=+t),r<0||e.byteLength<r||e.byteLength<n)throw new RangeError("Out of range index");if(void 0===r&&(r=0),void 0===n&&(n=e.byteLength),n<=r)return e;if(t||(t=0),"number"==typeof t)for(let s=r;s<n;++s)e[s]=t;else{const i=(t=f(t)?t:d(t,s)).byteLength;for(let s=0;s<n-r;++s)e[s+r]=t[s%i]}return e},from:d,includes:function(e,t,r,n){return-1!==h(e,t,r,n)},indexOf:h,lastIndexOf:function(e,t,r,n){return l(e,t,r,n,!1)},swap16:function(e){const t=e.byteLength;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<t;r+=2)p(e,r,r+1);return e},swap32:function(e){const t=e.byteLength;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<t;r+=4)p(e,r,r+3),p(e,r+1,r+2);return e},swap64:function(e){const t=e.byteLength;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<t;r+=8)p(e,r,r+7),p(e,r+1,r+6),p(e,r+2,r+5),p(e,r+3,r+4);return e},toBuffer:function(e){return e},toString:function(e,t,r=0,n=e.byteLength){const s=e.byteLength;return r>=s||n<=r?"":(r<0&&(r=0),n>s&&(n=s),(0!==r||n<s)&&(e=e.subarray(r,n)),u(t).toString(e))},write:function(e,t,r,n,s){return void 0===r?s="utf8":void 0===n&&"string"==typeof r?(s=r,r=void 0):void 0===s&&"string"==typeof n&&(s=n,n=void 0),u(s).write(e,t,r,n)},writeDoubleLE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setFloat64(r,t,!0),r+8},writeFloatLE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setFloat32(r,t,!0),r+4},writeUInt32LE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setUint32(r,t,!0),r+4},writeInt32LE:function(e,t,r){return void 0===r&&(r=0),new DataView(e.buffer,e.byteOffset,e.byteLength).setInt32(r,t,!0),r+4},readDoubleLE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},readFloatLE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},readUInt32LE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(t,!0)},readInt32LE:function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getInt32(t,!0)}}}(d,d.exports);var E=d.exports,A=a(E),T={};const O=T.LE=255===new Uint8Array(new Uint16Array([255]).buffer)[0];T.BE=!O;var C={exports:{}};!function(e,t){const r=E,{BE:n}=T,s=(t=e.exports={preencode(e,t){e.end+=t.byteLength},encode(e,t){e.buffer.set(t,e.start),e.start+=t.byteLength},decode(e){const t=e.buffer.subarray(e.start,e.end);return e.start=e.end,t}}).buffer={preencode(e,t){t?o.preencode(e,t):e.end++},encode(e,t){t?o.encode(e,t):e.buffer[e.start++]=0},decode(e){const t=e.buffer.subarray(e.start);return 0===t.byteLength?null:(e.start=e.end,t)}};function i(e,t){const r=e.BYTES_PER_ELEMENT;return{preencode(e,t){e.end+=t.byteLength},encode(e,r){const s=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);n&&t&&t(s),e.buffer.set(s,e.start),e.start+=r.byteLength},decode(s){let i=s.buffer.subarray(s.start);return i.byteOffset%r!=0&&(i=new Uint8Array(i)),n&&t&&t(i),s.start=s.end,new e(i.buffer,i.byteOffset,i.byteLength/r)}}}t.binary={...s,preencode(e,t){"string"==typeof t?u.preencode(e,t):s.preencode(e,t)},encode(e,t){"string"==typeof t?u.encode(e,t):s.encode(e,t)}},t.arraybuffer={preencode(e,t){e.end+=t.byteLength},encode(e,t){const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength},decode(e){const t=new ArrayBuffer(e.end-e.start);return new Uint8Array(t).set(e.buffer.subarray(e.start)),e.start=e.end,t}};const o=t.uint8array=i(Uint8Array);function a(e){return{preencode(t,n){t.end+=r.byteLength(n,e)},encode(t,n){t.start+=r.write(t.buffer,n,t.start,e)},decode(t){const n=r.toString(t.buffer,e,t.start);return t.start=t.end,n}}}t.uint16array=i(Uint16Array,r.swap16),t.uint32array=i(Uint32Array,r.swap32),t.int8array=i(Int8Array),t.int16array=i(Int16Array,r.swap16),t.int32array=i(Int32Array,r.swap32),t.biguint64array=i(BigUint64Array,r.swap64),t.bigint64array=i(BigInt64Array,r.swap64),t.float32array=i(Float32Array,r.swap32),t.float64array=i(Float64Array,r.swap64);const u=t.string=t.utf8=a("utf-8");t.ascii=a("ascii"),t.hex=a("hex"),t.base64=a("base64"),t.ucs2=t.utf16le=a("utf16le"),t.array=function(e){return{preencode(t,r){for(const n of r)e.preencode(t,n)},encode(t,r){for(const n of r)e.encode(t,n)},decode(t){const r=[];for(;t.start<t.end;)r.push(e.decode(t));return r}}},t.json={preencode(e,t){u.preencode(e,JSON.stringify(t))},encode(e,t){u.encode(e,JSON.stringify(t))},decode:e=>JSON.parse(u.decode(e))},t.ndjson={preencode(e,t){u.preencode(e,JSON.stringify(t)+"\n")},encode(e,t){u.encode(e,JSON.stringify(t)+"\n")},decode:e=>JSON.parse(u.decode(e))}}(C,C.exports);var W=C.exports,R={preencode:function e(t,r){if(r<251)t.end++;else if(r<256)t.end+=2;else if(r<65536)t.end+=3;else if(r<16777216)t.end+=4;else if(r<4294967296)t.end+=5;else{t.end++;const n=Math.floor(Math.log(r)/Math.log(2))-32;e(t,n),t.end+=6}},encode:function e(t,r){const n=251,s=r-n;if(r<n)t.buffer[t.start++]=r;else if(r<256)t.buffer[t.start++]=n,t.buffer[t.start++]=s;else if(r<65536)t.buffer[t.start++]=252,t.buffer[t.start++]=s>>8&255,t.buffer[t.start++]=255&s;else if(r<16777216)t.buffer[t.start++]=253,t.buffer[t.start++]=s>>16,t.buffer[t.start++]=s>>8&255,t.buffer[t.start++]=255&s;else if(r<4294967296)t.buffer[t.start++]=254,t.buffer[t.start++]=s>>24,t.buffer[t.start++]=s>>16&255,t.buffer[t.start++]=s>>8&255,t.buffer[t.start++]=255&s;else{const r=Math.floor(Math.log(s)/Math.log(2))-32;t.buffer[t.start++]=255,e(t,r);const n=s/Math.pow(2,r-11);for(let e=5;e>=0;e--)t.buffer[t.start++]=n/Math.pow(2,8*e)&255}},decode:function e(t){const r=251;if(t.end-t.start<1)throw new Error("Out of bounds");const n=t.buffer[t.start++];if(n<r)return n;if(t.end-t.start<n-r+1)throw new Error("Out of bounds.");if(n<252)return t.buffer[t.start++]+r;if(n<253)return(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<254)return(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<255)return 16777216*t.buffer[t.start++]+(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;const s=e(t);if(t.end-t.start<6)throw new Error("Out of bounds");let i=0;for(let e=5;e>=0;e--)i+=t.buffer[t.start++]*Math.pow(2,8*e);return i*Math.pow(2,s-11)+r}};!function(e){const t=E,{BE:r}=T;e.state=function(e=0,t=0,r=null){return{start:e,end:t,buffer:r,cache:null}};const n=e.raw=W,s=e.uint={preencode(e,t){e.end+=t<=252?1:t<=65535?3:t<=4294967295?5:9},encode(e,t){t<=252?i.encode(e,t):t<=65535?(e.buffer[e.start++]=253,o.encode(e,t)):t<=4294967295?(e.buffer[e.start++]=254,u.encode(e,t)):(e.buffer[e.start++]=255,c.encode(e,t))},decode(e){const t=i.decode(e);return t<=252?t:253===t?o.decode(e):254===t?u.decode(e):c.decode(e)}},i=e.uint8={preencode(e,t){e.end+=1},encode(e,t){e.buffer[e.start++]=t},decode(e){if(e.start>=e.end)throw new Error("Out of bounds");return e.buffer[e.start++]}},o=e.uint16={preencode(e,t){e.end+=2},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8},decode(e){if(e.end-e.start<2)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]}},a=e.uint24={preencode(e,t){e.end+=3},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16},decode(e){if(e.end-e.start<3)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]}},u=e.uint32={preencode(e,t){e.end+=4},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16,e.buffer[e.start++]=t>>>24},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]+16777216*e.buffer[e.start++]}},f=e.uint40={preencode(e,t){e.end+=5},encode(e,t){const r=Math.floor(t/256);i.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<5)throw new Error("Out of bounds");return i.decode(e)+256*u.decode(e)}},d=e.uint48={preencode(e,t){e.end+=6},encode(e,t){const r=Math.floor(t/65536);o.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<6)throw new Error("Out of bounds");return o.decode(e)+65536*u.decode(e)}},l=e.uint56={preencode(e,t){e.end+=7},encode(e,t){const r=Math.floor(t/16777216);a.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<7)throw new Error("Out of bounds");return a.decode(e)+16777216*u.decode(e)}},c=e.uint64={preencode(e,t){e.end+=8},encode(e,t){const r=Math.floor(t/4294967296);u.encode(e,t),u.encode(e,r)},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");return u.decode(e)+4294967296*u.decode(e)}};e.int=A(s),e.int8=A(i),e.int16=A(o),e.int24=A(a),e.int32=A(u),e.int40=A(f),e.int48=A(d),e.int56=A(l),e.int64=A(c);const h=e.biguint64={preencode(e,t){e.end+=8},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setBigUint64(0,t,!0),e.start+=8},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getBigUint64(0,!0);return e.start+=8,t}};e.bigint64=C(h);const p=e.biguint={preencode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.preencode(e,r),e.end+=8*r},encode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.encode(e,r);const n=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*r);for(let e=t,r=0;e;e>>=64n,r+=8)n.setBigUint64(r,BigInt.asUintN(64,e),!0);e.start+=8*r},decode(e){const t=s.decode(e);if(e.end-e.start<8*t)throw new Error("Out of bounds");const r=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*t);let n=0n;for(let e=t-1;e>=0;e--)n=(n<<64n)+r.getBigUint64(8*e,!0);return e.start+=8*t,n}};e.bigint=C(p),e.lexint=R,e.float32={preencode(e,t){e.end+=4},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).setFloat32(0,t,!0),e.start+=4},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).getFloat32(0,!0);return e.start+=4,t}},e.float64={preencode(e,t){e.end+=8},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setFloat64(0,t,!0),e.start+=8},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getFloat64(0,!0);return e.start+=8,t}};const b=e.buffer={preencode(e,t){t?w.preencode(e,t):e.end++},encode(e,t){t?w.encode(e,t):e.buffer[e.start++]=0},decode(e){const t=s.decode(e);if(0===t)return null;if(e.end-e.start<t)throw new Error("Out of bounds");return e.buffer.subarray(e.start,e.start+=t)}};function y(e,t){const n=e.BYTES_PER_ELEMENT;return{preencode(e,t){s.preencode(e,t.length),e.end+=t.byteLength},encode(e,n){s.encode(e,n.length);const i=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);r&&t&&t(i),e.buffer.set(i,e.start),e.start+=n.byteLength},decode(i){const o=s.decode(i);let a=i.buffer.subarray(i.start,i.start+=o*n);if(a.byteLength!==o*n)throw new Error("Out of bounds");return a.byteOffset%n!=0&&(a=new Uint8Array(a)),r&&t&&t(a),new e(a.buffer,a.byteOffset,a.byteLength/n)}}}e.binary={...b,preencode(e,t){"string"==typeof t?m.preencode(e,t):b.preencode(e,t)},encode(e,t){"string"==typeof t?m.encode(e,t):b.encode(e,t)}},e.arraybuffer={preencode(e,t){s.preencode(e,t.byteLength),e.end+=t.byteLength},encode(e,t){s.encode(e,t.byteLength);const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength},decode(e){const t=s.decode(e),r=new ArrayBuffer(t);return new Uint8Array(r).set(e.buffer.subarray(e.start,e.start+=t)),r}};const w=e.uint8array=y(Uint8Array);function g(e){return{preencode(r,n){const i=t.byteLength(n,e);s.preencode(r,i),r.end+=i},encode(r,n){const i=t.byteLength(n,e);s.encode(r,i),t.write(r.buffer,n,r.start,e),r.start+=i},decode(r){const n=s.decode(r);if(r.end-r.start<n)throw new Error("Out of bounds");return t.toString(r.buffer,e,r.start,r.start+=n)},fixed:r=>({preencode(e){e.end+=r},encode(n,s){t.write(n.buffer,s,n.start,r,e),n.start+=r},decode(n){if(n.end-n.start<r)throw new Error("Out of bounds");return t.toString(n.buffer,e,n.start,n.start+=r)}})}}e.uint16array=y(Uint16Array,t.swap16),e.uint32array=y(Uint32Array,t.swap32),e.int8array=y(Int8Array),e.int16array=y(Int16Array,t.swap16),e.int32array=y(Int32Array,t.swap32),e.biguint64array=y(BigUint64Array,t.swap64),e.bigint64array=y(BigInt64Array,t.swap64),e.float32array=y(Float32Array,t.swap32),e.float64array=y(Float64Array,t.swap64);const m=e.string=e.utf8=g("utf-8");e.ascii=g("ascii"),e.hex=g("hex"),e.base64=g("base64"),e.ucs2=e.utf16le=g("utf16le"),e.bool={preencode(e,t){e.end++},encode(e,t){e.buffer[e.start++]=t?1:0},decode(e){if(e.start>=e.end)throw Error("Out of bounds");return 1===e.buffer[e.start++]}};const _=e.fixed=function(e){return{preencode(t,r){t.end+=e},encode(t,r){t.buffer.set(r,t.start),t.start+=e},decode(t){if(t.end-t.start<e)throw new Error("Out of bounds");return t.buffer.subarray(t.start,t.start+=e)}}};e.fixed32=_(32),e.fixed64=_(64),e.array=function(e){return{preencode(t,r){s.preencode(t,r.length);for(let n=0;n<r.length;n++)e.preencode(t,r[n])},encode(t,r){s.encode(t,r.length);for(let n=0;n<r.length;n++)e.encode(t,r[n])},decode(t){const r=s.decode(t);if(r>1048576)throw new Error("Array is too big");const n=new Array(r);for(let s=0;s<r;s++)n[s]=e.decode(t);return n}}},e.frame=function(t){const r=e.state();return{preencode(e,r){const n=e.end;t.preencode(e,r),s.preencode(e,e.end-n)},encode(e,n){r.end=0,t.preencode(r,n),s.encode(e,r.end),t.encode(e,n)},decode(e){const r=e.end,n=s.decode(e);e.end=e.start+n;const i=t.decode(e);return e.start=e.end,e.end=r,i}}},e.json={preencode(e,t){m.preencode(e,JSON.stringify(t))},encode(e,t){m.encode(e,JSON.stringify(t))},decode:e=>JSON.parse(m.decode(e))},e.ndjson={preencode(e,t){m.preencode(e,JSON.stringify(t)+"\n")},encode(e,t){m.encode(e,JSON.stringify(t)+"\n")},decode:e=>JSON.parse(m.decode(e))},e.none={preencode(e,t){},encode(e,t){},decode:e=>null};const S={preencode(e,t){s.preencode(e,t.length);for(let r=0;r<t.length;r++)L.preencode(e,t[r])},encode(e,t){s.encode(e,t.length);for(let r=0;r<t.length;r++)L.encode(e,t[r])},decode(e){const t=[];let r=s.decode(e);for(;r-- >0;)t.push(L.decode(e));return t}},x={preencode(e,t){const r=Object.keys(t);s.preencode(e,r.length);for(const n of r)m.preencode(e,n),L.preencode(e,t[n])},encode(e,t){const r=Object.keys(t);s.encode(e,r.length);for(const n of r)m.encode(e,n),L.encode(e,t[n])},decode(e){let t=s.decode(e);const r={};for(;t-- >0;){r[m.decode(e)]=L.decode(e)}return r}},v=[e.none,e.bool,e.string,e.buffer,e.uint,e.int,e.float64,S,x],L=e.any={preencode(e,t){const r=k(t);s.preencode(e,r),v[r].preencode(e,t)},encode(e,t){const r=k(t);s.encode(e,r),v[r].encode(e,t)},decode(e){const t=s.decode(e);if(t>=v.length)throw new Error("Unknown type: "+t);return v[t].decode(e)}};function k(e){if(null==e)return 0;if("boolean"==typeof e)return 1;if("string"==typeof e)return 2;if(t.isBuffer(e))return 3;if("number"==typeof e)return Number.isInteger(e)?e>=0?4:5:6;if(Array.isArray(e))return 7;if("object"==typeof e)return 8;throw new Error("Unsupported type for "+e)}function A(e){return{preencode(t,r){e.preencode(t,O(r))},encode(t,r){e.encode(t,O(r))},decode:t=>function(e){return 0===e?e:1&e?-(e+1)/2:e/2}(e.decode(t))}}function O(e){return e<0?2*-e-1:0===e?0:2*e}function C(e){return{preencode(t,r){e.preencode(t,N(r))},encode(t,r){e.encode(t,N(r))},decode:t=>function(e){return 0n===e?e:0n===(1n&e)?e/2n:-(e+1n)/2n}(e.decode(t))}}function N(e){return e<0n?2n*-e-1n:0n===e?0n:2n*e}e.from=function(e){return"string"==typeof e?function(e){switch(e){case"ascii":return n.ascii;case"utf-8":case"utf8":return n.utf8;case"hex":return n.hex;case"base64":return n.base64;case"utf16-le":case"utf16le":case"ucs-2":case"ucs2":return n.ucs2;case"ndjson":return n.ndjson;case"json":return n.json;default:return n.binary}}(e):e.preencode?e:e.encodingLength?function(e){return{preencode(t,r){t.end+=e.encodingLength(r)},encode(t,r){e.encode(r,t.buffer,t.start),t.start+=e.encode.bytes},decode(t){const r=e.decode(t.buffer,t.start,t.end);return t.start+=e.decode.bytes,r}}}(e):function(e){let t=null,r=null;return{preencode(n,s){t=s,r=e.encode(s),n.end+=r.byteLength},encode(s,i){n.encode(s,i===t?r:e.encode(i)),t=r=null},decode:t=>e.decode(n.decode(t))}}(e)},e.encode=function(r,n){const s=e.state();return r.preencode(s,n),s.buffer=t.allocUnsafe(s.end),r.encode(s,n),s.buffer},e.decode=function(t,r){return t.decode(e.state(0,r.byteLength,r))}}(f);var N=a(f);function U(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}function M(e){return"undefined"!=typeof WritableStream&&e instanceof WritableStream}function P(e){return Array.isArray(e)?2===e.length&&U(e[0])&&M(e[1]):"object"==typeof e&&null!==e&&U(e.readable)&&M(e.writable)}var j,q={exports:{}},B="object"==typeof Reflect?Reflect:null,I=B&&"function"==typeof B.apply?B.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};j=B&&"function"==typeof B.ownKeys?B.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var D=Number.isNaN||function(e){return e!=e};function F(){F.init.call(this)}q.exports=F;var V=q.exports.once=function(e,t){return new Promise((function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}Z(e,t,i,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&Z(e,"error",t,{once:!0})}(e,s)}))};F.EventEmitter=F,F.prototype._events=void 0,F.prototype._eventsCount=0,F.prototype._maxListeners=void 0;var Q=10;function J(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function z(e){return void 0===e._maxListeners?F.defaultMaxListeners:e._maxListeners}function $(e,t,r,n){var s,i,o,a;if(J(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(s=z(e))>0&&o.length>s&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=G.bind(n);return s.listener=r,n.wrapFn=s,s}function Y(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):X(s,s.length)}function H(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function X(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function Z(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){n.once&&e.removeEventListener(t,s),r(i)}))}}Object.defineProperty(F,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(e){if("number"!=typeof e||e<0||D(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Q=e}}),F.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},F.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||D(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},F.prototype.getMaxListeners=function(){return z(this)},F.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var a=s[e];if(void 0===a)return!1;if("function"==typeof a)I(a,this,t);else{var u=a.length,f=X(a,u);for(r=0;r<u;++r)I(f[r],this,t)}return!0},F.prototype.addListener=function(e,t){return $(this,e,t,!1)},F.prototype.on=F.prototype.addListener,F.prototype.prependListener=function(e,t){return $(this,e,t,!0)},F.prototype.once=function(e,t){return J(t),this.on(e,K(this,e,t)),this},F.prototype.prependOnceListener=function(e,t){return J(t),this.prependListener(e,K(this,e,t)),this},F.prototype.removeListener=function(e,t){var r,n,s,i,o;if(J(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},F.prototype.off=F.prototype.removeListener,F.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},F.prototype.listeners=function(e){return Y(this,e,!0)},F.prototype.rawListeners=function(e){return Y(this,e,!1)},F.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):H.call(e,t)},F.prototype.listenerCount=H,F.prototype.eventNames=function(){return this._eventsCount>0?j(this._events):[]};var ee=q.exports,te=q.exports.EventEmitter,re=q.exports.init,ne=q.exports.listenerCount,se=u(Object.freeze({__proto__:null,EventEmitter:te,default:ee,init:re,listenerCount:ne,once:V})),ie="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);const oe=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};function ae(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream}function ue(e){return"undefined"!=typeof WritableStream&&e instanceof WritableStream}function fe(e){return Array.isArray(e)?2===e.length&&ae(e[0])&&ue(e[1]):"object"==typeof e&&null!==e&&ae(e.readable)&&ue(e.writable)}function de(e,t={}){return new(r=t.write||e.writable?t.asTransform?Ft.Transform:Ft.Duplex:Ft.Readable,class extends r{bytesRead=0;released=!1;pendingRead=void 0;constructor(e,t={}){if(!e||e instanceof ReadableStream||(("function"==typeof e.writable||e.writable instanceof WritableStream)&&(t.write=e.writable),e.readable instanceof ReadableStream&&(e=e.readable)),!(e instanceof ReadableStream))throw new Error("fromWeb: Requires at the very least a readable stream. This may change in future.");let{read:r,...n}=t;const s=n.write instanceof WritableStream;let i;if(s){let e;({write:e,...n}=n),i=e.getWriter()}super(n);const o=this;this.reader=e.getReader(),this.writer=i,s&&(this.onFinish=new Promise((e=>o.once("finish",e))))}async _write(e,t){if(!this.writer||!this.writable)throw new Error("Not writable");if(await this.writer.ready,this.destroyed||this.released)return t();await this.writer.write(e),t()}async _read(e){if(this.released)this.push(null);else{this.pendingRead=this.reader.read();const e=await this.pendingRead;delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}e()}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async waitForWriteToComplete(){await this.writer.ready}async syncAndRelease(){this.released=!0,this.writer&&(await this.waitForWriteToComplete(),await this.onFinish,await this.writer.releaseLock()),await this.waitForReadToComplete(),await this.reader.releaseLock()}async close(){await this.syncAndRelease()}})(e,t);var r}const le=256<<17;function ce(e,t){let r,n=!1;const s={};if(e&&("number"!=typeof(i=e)._duplexState||!function(e){return!!e._readableState||!!e._writableState}(i))){let t;({readable:e,writable:r,duplex:t}=e),!t||e||r||(e=t,r=t)}var i;if(!e&&!r)throw new Error("Invalid stream");let o,a;return e&&(o=new ReadableStream({start:function(t){s.data=r,s.end=r,s.end=i,s.close=i,s.error=i;for(let t in s)e.on(t,s[t]);function r(r){n||(t.enqueue("string"==typeof r?A.from(r):r),e.pause())}function i(r){if(!n){n=!0;for(let t in s)e.off(t,s[t]);r?t.error(r):t.close()}}e.pause()},pull:function(){n||e.resume()},cancel:function(){n=!0;for(let t in s)e.off(t,s[t]);e.push(null),e.pause(),e.destroy?e.destroy():e.close&&e.close()},type:void 0}),!r)?o:r&&(a=new WritableStream({async write(e){r.write("string"==typeof e?A.from(e):e)||await function(e,t=!1){if(e.destroyed)return Promise.resolve(!1);const r=e._writableState,n=(t?Math.min(1,r.queue.length):r.queue.length)+(e._duplexState&le?1:0);return 0===n?Promise.resolve(!0):(null===r.drains&&(r.drains=[]),new Promise((e=>{r.drains.push({writes:n,resolve:e})})))}(r,!1)}}),!e)?a:{readable:o,writable:a}}function he(e,t){if(e instanceof ArrayBuffer&&(e=A.from(e)),A.isBuffer(e))return N.decode(t,e);if(ae(e)||ue(e)||fe(e)||Ft.isStream(e))return Array.isArray(e)&&(e={readable:e[0],writable:e[1]}),de(e);if(Array.isArray(e))return e.map((e=>he(e,t)));if("object"==typeof e&&null!==e){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=he(e[n],t));return r}return e}function pe(e,t){if(function(e){return e instanceof ArrayBuffer||e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||"undefined"!=typeof WritableStream&&e instanceof WritableStream||fe(e)||ae(e)||ue(e)}(e))return[e];if(r=e,r?._readableState&&r?._writableState){const{readable:t,writable:r}=ce({duplex:e});return[t,r]}var r;if(function(e){return!!e?._readableState}(e)){return[ce(e)]}return ae(e)||ue(e)?ce(e):Array.isArray(e)&&!A.isBuffer(e)?e.flatMap((e=>pe(e,t))):[N.encode(t,e).buffer]}function be(e,t=N.any){return i({send:r=>{if(r.result)r.transfer=pe(r.result,t),r.result=!0;else if(r.params){r.idx=[],r.transfer=[];for(const e of r.params){const n=pe(e,t);r.idx.push(n.length),r.transfer.push(...n)}delete r.params}return e.postMessage(r,r.transfer||[])},attach:r=>{const n=e=>{const n=e.data;if(!n.transfer)return r(n);if(!0===n.result)1===n.transfer.length&&(n.transfer=n.transfer[0]),n.result=he(n.transfer,t);else{let e=0;n.params=n.idx.map((r=>{const s=he(n.transfer.slice(e,e+r),t);return e+=r,Array.isArray(s)&&1===s.length?s[0]:s}))}return delete n.transfer,r(n)};return e.addEventListener("message",n),()=>e.removeEventListener("message",n)}})}let ye=0;"undefined"==typeof navigator&&(globalThis.navigator={hardwareConcurrency:4});var we=Object.freeze({__proto__:null,WorkerPool:class{constructor(e,t=Math.min(navigator.hardwareConcurrency/2,4)){this.poolSize=t,this.workers=[],this.taskQueue=[],this.idleWorkers=[],this._terminated=!1;for(let r=0;r<t;r++)this._createWorker(e),ye++}_createWorker(e){const t=new e,r=function(e,t=N.any){return i({send:r=>{if(r.result)r.transfer=pe(r.result,t),r.result=!0;else if(r.params){r.idx=[],r.transfer=[];for(const e of r.params){const n=pe(e,t);r.idx.push(n.length),r.transfer.push(...n)}delete r.params}return e.postMessage(r,r.transfer||[])},attach:r=>{const n=e=>{const n=e.data;if(!n.transfer)return r(n);if(!0===n.result)1===n.transfer.length&&(n.transfer=n.transfer[0]),n.result=he(n.transfer,t);else{let e=0;n.params=n.idx.map((r=>{const s=he(n.transfer.slice(e,e+r),t);return e+=r,Array.isArray(s)&&1===s.length?s[0]:s}))}return delete n.transfer,r(n)};return e.addEventListener("message",n),()=>e.removeEventListener("message",n)}})}(t);t.rpc=r,this.workers.push(t),this.idleWorkers.push(t)}_processQueue(){if(this.taskQueue.length>0&&this.idleWorkers.length>0){const{method:e,resolve:t,reject:r,type:n,args:s=[],worker:i=this.idleWorkers.shift()}=this.taskQueue.shift();"request"===n?i.rpc.request[e](...s).then((e=>{t({result:e,worker:i})})).catch((e=>{r(e)})).finally((()=>{this.idleWorkers.push(i),this._processQueue()})):"notify"===n&&(i.rpc.notify[e](...s),t({worker:i}),this.idleWorkers.push(i),this._processQueue())}}addTaskToWorker(e,t,r=[],n="request"){return this.addTaskComplex(t,r,n,e)}addTask(e,t=[],r="request"){return this.addTaskComplex(e,t,r).then((({result:e})=>e))}addTaskComplex(e,t=[],r="request",n){if(this._terminated)throw new Error("Worker pool has been terminated.");if("request"!==r&&"notify"!==r)throw new Error('Invalid task type. Must be "request" or "notify".');return new Promise(((s,i)=>{this.taskQueue.push({method:e,resolve:s,reject:i,type:r,args:t,worker:n}),this._processQueue()}))}addRequestTask(e,t=[]){return this.addTask(e,t,"request")}addRequestTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"request",e)}addRequestTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"request")}addNotifyTask(e,t=[]){return this.addTask(e,t,"notify")}addNotifyTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"notify",e)}addNotifyTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"notify")}terminateAllWorkers(){this.workers.forEach((e=>{e.terminate(),ye--})),this.workers=[],this.idleWorkers=[],this._terminated=!0}},get currentWorkerCount(){return ye}}),ge=u(Object.freeze({__proto__:null,Pool:we,attachRpc:be,rpcFromWebWorker:o,rpcFromWebWorkerWithTransfer:be}));const{EventEmitter:me}=se,_e=new Error("Stream was destroyed"),Se=new Error("Premature close"),xe=ie,ve=class{constructor(e){this.hwm=e||16,this.head=new oe(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new oe(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){const e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}isEmpty(){return 0===this.length}},Le=ge,ke=536870911,Ee=1^ke,Ae=2^ke,Te=64,Oe=128,Ce=256,We=1024,Re=2048,Ne=4096,Ue=8192,Me=16384,Pe=32768,je=131072,qe=131328,Be=16^ke,Ie=768^ke,De=536838143,Fe=32^ke,Ve=536739839,Qe=2<<18,Je=4<<18,ze=8<<18,$e=16<<18,Ge=32<<18,Ke=64<<18,Ye=128<<18,He=256<<18,Xe=512<<18,Ze=1024<<18,et=469499903,tt=535822335,rt=503316479,nt=268435455,st=262160,it=536608751,ot=8404992,at=14,ut=15,ft=8405006,dt=33587200,lt=33587215,ct=2359296,ht=270794767,pt=Symbol.asyncIterator||Symbol("asyncIterator");class bt{constructor(e,{highWaterMark:t=16384,map:r=null,mapWritable:n,byteLength:s,byteLengthWritable:i}={}){this.stream=e,this.queue=new ve,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=i||s||Bt,this.map=n||r,this.afterWrite=xt.bind(this),this.afterUpdateNextTick=kt.bind(this)}get ended(){return!!(this.stream._duplexState&Ge)}push(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=ze,!0):(this.stream._duplexState|=6291456,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=534773759),e}end(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=(this.stream._duplexState|Xe)&tt}autoBatch(e,t){const r=[],n=this.stream;for(r.push(e);(n._duplexState&ht)===ct;)r.push(n._writableState.shift());if(n._duplexState&ut)return t(null);n._writev(r,t)}update(){const e=this.stream;e._duplexState|=Qe;do{for(;(e._duplexState&ht)===ze;){const t=this.shift();e._duplexState|=67371008,e._write(t,this.afterWrite)}1310720&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=536346623}updateNonPrimary(){const e=this.stream;if((144965647&e._duplexState)===Xe)return e._duplexState=402653183&e._duplexState|262144,void e._final(_t.bind(this));4!=(e._duplexState&at)?1==(e._duplexState&lt)&&(e._duplexState=(e._duplexState|st)&Ee,e._open(Et.bind(this))):e._duplexState&dt||(e._duplexState|=st,e._destroy(St.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&Ye)&&(this.stream._duplexState&=rt,!0)}updateCallback(){(35127311&this.stream._duplexState)===Je?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Ye||(this.stream._duplexState|=Ye,this.stream._duplexState&Qe||xe(this.afterUpdateNextTick))}}class yt{constructor(e,{highWaterMark:t=16384,map:r=null,mapReadable:n,byteLength:s,byteLengthReadable:i}={}){this.stream=e,this.queue=new ve,this.highWaterMark=0===t?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=i||s||Bt,this.map=n||r,this.pipeTo=null,this.afterRead=vt.bind(this),this.afterUpdateNextTick=Lt.bind(this)}get ended(){return!!(this.stream._duplexState&Me)}pipe(e,t){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new gt(this.stream,e,t),t&&this.stream.on("error",It),qt(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",It),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const t=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",mt.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=536805311&t._duplexState|1024,!1):(null!==this.map&&null===(e=this.map(e))||(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=536805375&t._duplexState|128),this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=536862591),e}unshift(e){const t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){const r=t[e];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((16527&e._duplexState)===Oe){const t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Ie),e._duplexState&Re&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=je,this.updateNextTick()),null}drain(){const e=this.stream;for(;(16527&e._duplexState)===Oe&&768&e._duplexState;){const t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=Ie),e._duplexState&Re&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)===je;)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=Ue,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=Fe}updateNonPrimary(){const e=this.stream;(1167&e._duplexState)===We&&(e._duplexState=536869887&e._duplexState|16384,e.emit("end"),(e._duplexState&ft)===ot&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(e._duplexState&at)?1==(e._duplexState&lt)&&(e._duplexState=(e._duplexState|st)&Ee,e._open(Et.bind(this))):e._duplexState&dt||(e._duplexState|=st,e._destroy(St.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&Pe)&&(this.stream._duplexState&=De,!0)}updateCallback(){(32879&this.stream._duplexState)===Te?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&Pe||(this.stream._duplexState|=Pe,32&this.stream._duplexState||xe(this.afterUpdateNextTick))}}class wt{constructor(e){this.data=null,this.afterTransform=At.bind(e),this.afterFinal=null}}class gt{constructor(e,t,r){this.from=e,this.to=t,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&Me||this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&Me&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function mt(){this.stream._duplexState|=512,this.updateCallback()}function _t(e){const t=this.stream;e&&t.destroy(e),t._duplexState&at||(t._duplexState|=Ge,t.emit("finish")),(t._duplexState&ft)===ot&&(t._duplexState|=4),t._duplexState&=et,t._duplexState&Qe?this.updateNextTick():this.update()}function St(e){const t=this.stream;e||this.error===_e||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");const r=t._readableState,n=t._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(t,e),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(t,e)}}function xt(e){const t=this.stream;e&&t.destroy(e),t._duplexState&=et,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),(6553615&t._duplexState)===$e&&(t._duplexState&=532676607,(t._duplexState&Ke)===Ke&&t.emit("drain")),this.updateCallback()}function vt(e){e&&this.stream.destroy(e),this.stream._duplexState&=Be,!1!==this.readAhead||this.stream._duplexState&Ce||(this.stream._duplexState&=Ve),this.updateCallback()}function Lt(){32&this.stream._duplexState||(this.stream._duplexState&=De,this.update())}function kt(){this.stream._duplexState&Qe||(this.stream._duplexState&=rt,this.update())}function Et(e){const t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=Te),142606351&t._duplexState||(t._duplexState|=Je),t.emit("open")),t._duplexState&=it,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function At(e,t){null!=t&&this.push(t),this._writableState.afterWrite(e)}function Tt(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=Ne,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=Ke,this._writableState.updateNextTick())}class Ot extends me{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",Dt.bind(this))),this.on("newListener",Tt)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&at)}destroy(e){this._duplexState&at||(e||(e=_e),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=Ae,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class Ct extends Ot{constructor(e){super(e),this._duplexState|=8519681,this._readableState=new yt(this,e),e&&(!1===this._readableState.readAhead&&(this._duplexState&=Ve),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){const t=new Le(e),r=this._readableState.map||Pt;return this._readableState.map=function(e){const n=t.push(e);return""===n?null:r(n)},this}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=qe,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(e,t){let r;const n=new Ct({...t,read(t){e.next().then(s).then(t.bind(null,null)).catch(t)},predestroy(){r=e.return()},destroy(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}});return n;function s(e){e.done?n.push(null):n.push(e.value)}}static from(e,t){if(qt(r=e)&&r.readable)return e;var r;if(e[pt])return this._fromAsyncIterator(e[pt](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);let n=0;return new Ct({...t,read(t){this.push(n===e.length?null:e[n++]),t(null)}})}static isBackpressured(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return!(e._duplexState&Ce)}[pt](){const e=this;let t=null,r=null,n=null;return this.on("error",(e=>{t=e})),this.on("readable",(function(){null!==r&&s(e.read())})),this.on("close",(function(){null!==r&&s(null)})),{[pt](){return this},next:()=>new Promise((function(t,i){r=t,n=i;const o=e.read();null!==o?s(o):8&e._duplexState&&s(null)})),return:()=>i(null),throw:e=>i(e)};function s(s){null!==n&&(t?n(t):null!==s||e._duplexState&Me?r({value:s,done:null===s}):n(_e),n=r=null)}function i(t){return e.destroy(t),new Promise(((r,n)=>{if(8&e._duplexState)return r({value:void 0,done:!0});e.once("close",(function(){t?n(t):r({value:void 0,done:!0})}))}))}}}class Wt extends Ot{constructor(e){super(e),this._duplexState|=16385,this._writableState=new bt(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Ze}uncork(){this._duplexState&=nt,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return!!(146800654&e._duplexState)}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=function(e){return e._writev!==Wt.prototype._writev&&e._writev!==Rt.prototype._writev}(e)?Math.min(1,t.queue.length):t.queue.length,n=r+(e._duplexState&He?1:0);return 0===n?Promise.resolve(!0):(null===t.drains&&(t.drains=[]),new Promise((e=>{t.drains.push({writes:n,resolve:e})})))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Rt extends Ct{constructor(e){super(e),this._duplexState=1|this._duplexState&je,this._writableState=new bt(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=Ze}uncork(){this._duplexState&=nt,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class Nt extends Rt{constructor(e){super(e),this._transformState=new wt(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(null!==this._transformState.data){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(Ut.bind(this))}}function Ut(e,t){const r=this._transformState.afterFinal;if(e)return r(e);null!=t&&this.push(t),this.push(null),r(null)}function Mt(e,...t){const r=Array.isArray(e)?[...e,...t]:[e,...t],n=r.length&&"function"==typeof r[r.length-1]?r.pop():null;if(r.length<2)throw new Error("Pipeline requires at least 2 streams");let s=r[0],i=null,o=null;for(let e=1;e<r.length;e++)i=r[e],qt(s)?s.pipe(i,u):(a(s,!0,e>1,u),s.pipe(i)),s=i;if(n){let e=!1;const t=qt(i)||!(!i._writableState||!i._writableState.autoDestroy);i.on("error",(e=>{null===o&&(o=e)})),i.on("finish",(()=>{e=!0,t||n(o)})),t&&i.on("close",(()=>n(o||(e?null:Se))))}return i;function a(e,t,r,n){e.on("error",n),e.on("close",(function(){if(e._readableState&&!e._readableState.ended)return n(Se);if(r&&e._writableState&&!e._writableState.ended)return n(Se)}))}function u(e){if(e&&!o){o=e;for(const t of r)t.destroy(e)}}}function Pt(e){return e}function jt(e){return!!e._readableState||!!e._writableState}function qt(e){return"number"==typeof e._duplexState&&jt(e)}function Bt(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function It(){}function Dt(){this.destroy(new Error("Stream aborted."))}var Ft={pipeline:Mt,pipelinePromise:function(...e){return new Promise(((t,r)=>Mt(...e,(e=>{if(e)return r(e);t()}))))},isStream:jt,isStreamx:qt,getStreamError:function(e){const t=e._readableState&&e._readableState.error||e._writableState&&e._writableState.error;return t===_e?null:t},Stream:Ot,Writable:Wt,Readable:Ct,Duplex:Rt,Transform:Nt,PassThrough:class extends Nt{}};function Vt(e,t){if(e instanceof ArrayBuffer&&(e=A.from(e)),A.isBuffer(e))return N.decode(t,e);if(U(e)||M(e)||P(e)||Ft.isStream(e))return Array.isArray(e)&&(e={readable:e[0],writable:e[1]}),de(e);if(Array.isArray(e))return e.map((e=>Vt(e,t)));if("object"==typeof e&&null!==e){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=Vt(e[n],t));return r}return e}function Qt(e,t){if(function(e){return e instanceof ArrayBuffer||e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||"undefined"!=typeof WritableStream&&e instanceof WritableStream||P(e)||U(e)||M(e)}(e))return[e];if(r=e,r?._readableState&&r?._writableState){const{readable:t,writable:r}=ce({duplex:e});return[t,r]}var r;if(function(e){return!!e?._readableState}(e)){return[ce(e)]}return U(e)||M(e)?ce(e):Array.isArray(e)&&!A.isBuffer(e)?e.flatMap((e=>Qt(e,t))):[N.encode(t,e).buffer]}function Jt(e,t=N.any){return i({send:r=>{if(r.result)r.transfer=Qt(r.result,t),r.result=!0;else if(r.params){r.idx=[],r.transfer=[];for(const e of r.params){const n=Qt(e,t);r.idx.push(n.length),r.transfer.push(...n)}delete r.params}return e.postMessage(r,r.transfer||[])},attach:r=>{const n=e=>{const n=e.data;if(!n.transfer)return r(n);if(!0===n.result)1===n.transfer.length&&(n.transfer=n.transfer[0]),n.result=Vt(n.transfer,t);else{let e=0;n.params=n.idx.map((r=>{const s=Vt(n.transfer.slice(e,e+r),t);return e+=r,Array.isArray(s)&&1===s.length?s[0]:s}))}return delete n.transfer,r(n)};return e.addEventListener("message",n),()=>e.removeEventListener("message",n)}})}let zt=0;"undefined"==typeof navigator&&(globalThis.navigator={hardwareConcurrency:4});var $t=Object.freeze({__proto__:null,WorkerPool:class{constructor(e,t=Math.min(navigator.hardwareConcurrency/2,4)){this.poolSize=t,this.workers=[],this.taskQueue=[],this.idleWorkers=[],this._terminated=!1;for(let r=0;r<t;r++)this._createWorker(e),zt++}_createWorker(e){const t=new e,r=Jt(t);t.rpc=r,this.workers.push(t),this.idleWorkers.push(t)}_processQueue(){if(this.taskQueue.length>0&&this.idleWorkers.length>0){const{method:e,resolve:t,reject:r,type:n,args:s=[],worker:i=this.idleWorkers.shift()}=this.taskQueue.shift();"request"===n?i.rpc.request[e](...s).then((e=>{t({result:e,worker:i})})).catch((e=>{r(e)})).finally((()=>{this.idleWorkers.push(i),this._processQueue()})):"notify"===n&&(i.rpc.notify[e](...s),t({worker:i}),this.idleWorkers.push(i),this._processQueue())}}addTaskToWorker(e,t,r=[],n="request"){return this.addTaskComplex(t,r,n,e)}addTask(e,t=[],r="request"){return this.addTaskComplex(e,t,r).then((({result:e})=>e))}addTaskComplex(e,t=[],r="request",n){if(this._terminated)throw new Error("Worker pool has been terminated.");if("request"!==r&&"notify"!==r)throw new Error('Invalid task type. Must be "request" or "notify".');return new Promise(((s,i)=>{this.taskQueue.push({method:e,resolve:s,reject:i,type:r,args:t,worker:n}),this._processQueue()}))}addRequestTask(e,t=[]){return this.addTask(e,t,"request")}addRequestTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"request",e)}addRequestTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"request")}addNotifyTask(e,t=[]){return this.addTask(e,t,"notify")}addNotifyTaskToWorker(e,t,r=[]){return this.addTaskComplex(t,r,"notify",e)}addNotifyTaskComplex(e,t=[]){return this.addTaskComplex(e,t,"notify")}terminateAllWorkers(){this.workers.forEach((e=>{e.terminate(),zt--})),this.workers=[],this.idleWorkers=[],this._terminated=!0}},get currentWorkerCount(){return zt}});export{$t as Pool,Jt as attachRpc,o as rpcFromWebWorker,Jt as rpcFromWebWorkerWithTransfer};
